# Phase 3: ì „ëµ-ì‹¤í–‰ ì—°ê²° - ìƒì„¸ ê³„íš

> **í•µì‹¬ ëª©í‘œ**: ê³ ìˆ˜ì¤€ ëª©í‘œê°€ ì‹¤í–‰ ê°€ëŠ¥í•œ íƒœìŠ¤í¬ë¡œ ìë™ ë¶„í•´ë˜ê³ , í™€ë¡ ì´ ììœ¨ì ìœ¼ë¡œ í”„ë¡œì íŠ¸ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ì‹œìŠ¤í…œ êµ¬ì¶•

---

## ê´€ë ¨ ë¬¸ì„œ ì°¸ì¡°

- **í•µì‹¬ ê°œë…**: [ssot.md](./ssot.md) - ë¹„ì „, ì›ì¹™, ì‘ë™ ë°©ì‹
- **êµ¬í˜„ ëª…ì„¸**: [blueprint.md](./blueprint.md) - DB ìŠ¤í‚¤ë§ˆ, TypeScript ì½”ë“œ, API ì •ì˜
- **ë‹¤ìŒ ë‹¨ê³„**: [phase4-dogfood-plan.md](./phase4-dogfood-plan.md) - Phase 4 Dogfooding ê³„íš

---

## âš ï¸ Critical Success Factor

**Phase 3 ì™„ë£Œ ì‹œ ë‹¬ì„± ëª©í‘œ**: Phase 4ë¥¼ í™€ë¡  íŒ€ì—ê²Œ ììœ¨ì ìœ¼ë¡œ ë§¡ê¸¸ ìˆ˜ ìˆëŠ” ìƒíƒœ

Phase 3ëŠ” "ììœ¨ì„± ë„êµ¬"ë¥¼ ë§Œë“œëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤. ì´ ë„êµ¬ë“¤ì´ ì œëŒ€ë¡œ ì‘ë™í•´ì•¼ Phase 4ë¶€í„° í™€ë¡ ì´ ì§„ì •ìœ¼ë¡œ ììœ¨ì ìœ¼ë¡œ ì¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Phase 4 Dogfoodingì„ ìœ„í•œ í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

1. âœ… **GoalDecompositionService**: ê³ ìˆ˜ì¤€ ëª©í‘œ â†’ 35ê°œ Task ìë™ ìƒì„±
2. âœ… **DependencyAnalyzer**: Task ê°„ ì˜ì¡´ì„± ê·¸ë˜í”„ ìë™ ë¶„ì„
3. âœ… **ResourcePlanner**: Skill ê¸°ë°˜ ìµœì  Hollon í• ë‹¹
4. âœ… **PriorityRebalancerService**: ì‹¤ì‹œê°„ ìš°ì„ ìˆœìœ„ ìë™ ì¡°ì •
5. âœ… **UncertaintyDecisionService**: ë¶ˆí™•ì‹¤í•œ ê²°ì • ì‹œ Spike POC ìë™ ì‹¤í–‰
6. âœ… **PivotResponseService**: ì „ëµ ë³€ê²½ ì‹œ ì˜í–¥ ë¶„ì„ ë° ëŒ€ì‘

---

## ì™„ë£Œ ê¸°ì¤€

Phase 3 ì™„ë£Œ ì‹œ ë‹¤ìŒì´ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤:

- [ ] **ëª©í‘œ ì…ë ¥ â†’ í”„ë¡œì íŠ¸/íƒœìŠ¤í¬ ìë™ ìƒì„±** (GoalDecomposition)
  - Milestoneì€ ì„ íƒì  ê·¸ë£¹í•‘ìœ¼ë¡œ ìë™ ë˜ëŠ” ìˆ˜ë™ ìƒì„± ê°€ëŠ¥
- [ ] **Task ì˜ì¡´ì„± ìë™ ë¶„ì„ ë° ì‹¤í–‰ ìˆœì„œ ê²°ì •** (DependencyAnalyzer)
- [ ] **Hollon ì—­ëŸ‰ ê¸°ë°˜ ìë™ í• ë‹¹** (ResourcePlanner)
- [ ] **ì‹¤ì‹œê°„ ì§„í–‰ë„ ëª¨ë‹ˆí„°ë§ ë° ìš°ì„ ìˆœìœ„ ì¬ì¡°ì •** (PriorityRebalancer)
- [ ] **ë¶ˆí™•ì‹¤ì„± ìë™ ê°ì§€ ë° Spike ìƒì„±** (UncertaintyDecision)
- [ ] **í”¼ë²— ì„ ì–¸ ì‹œ ì˜í–¥ ë¶„ì„ ìë™í™”** (PivotResponse)

**ê²€ì¦ ë°©ë²•**: Phase 4 ëª©í‘œë¥¼ ì…ë ¥í–ˆì„ ë•Œ 35ê°œ Taskê°€ ìë™ìœ¼ë¡œ ìƒì„±ë˜ê³ , ì˜ì¡´ì„± ê·¸ë˜í”„ì™€ í•¨ê»˜ 5ëª…ì˜ Hollonì—ê²Œ ìë™ í• ë‹¹ë˜ì–´ì•¼ í•¨.

---

## ssot.md ì»¤ë²„ë¦¬ì§€

Phase 3 ì™„ë£Œ ì‹œ ssot.md ë‹¬ì„±ë¥ : **ì•½ 85%**

| ssot.md ì„¹ì…˜            | Phase 3 ì»¤ë²„ë¦¬ì§€ | ë¹„ê³                                    |
| ----------------------- | ---------------- | -------------------------------------- |
| 1. ë¹„ì „ & í•µì‹¬ ê°œë…     | âœ… ê¸°ë°˜ ì „ì œ     | ë³€ê²½ ì—†ìŒ                              |
| 2. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜      | âœ… 100%          | -                                      |
| 3. í•µì‹¬ ì—”í‹°í‹°          | âœ… 85%           | Goal ì—”í‹°í‹° ì¶”ê°€                       |
| 4. ì‹œìŠ¤í…œ ì‘ë™ ë°©ì‹     | âœ… 80%           | 4.1~4.3 ì „ì²´ íë¦„ ì™„ì„±                 |
| 5. í•µì‹¬ ì›ì¹™            | âœ… 70%           | RAGëŠ” Phase 4                          |
| 6. ììœ¨ ìš´ì˜ ì •ì±…       | âœ… 90%           | 6.2~6.7 ëŒ€ë¶€ë¶„ êµ¬í˜„                    |
| **7. LLM í•œê³„ ëŒ€ì‘**    | **âœ… 80%**       | **Phase 3 í•µì‹¬ ë²”ìœ„**                  |
| 8. í˜‘ì—… ë° ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ | âœ… 90%           | Phase 2 ì™„ë£Œ                           |
| 9. ê¸°ìˆ  ìŠ¤íƒ            | âœ… 100%          | -                                      |
| 10. ìš©ì–´ ì •ë¦¬           | âœ… ì°¸ì¡°ìš©        | Goal, GoalDecomposition, Pivot ë“± ì¶”ê°€ |

**Phase 3ì—ì„œ êµ¬í˜„ë˜ëŠ” LLM í•œê³„ ëŒ€ì‘**:

- âœ… GoalDecompositionService (ì¥ê¸° ê³„íš ëŠ¥ë ¥ ë¶€ì¡± ëŒ€ì‘)
- âœ… UncertaintyDecisionService (ë¶ˆí™•ì‹¤ì„± ì²˜ë¦¬)
- â­ï¸ FactCheckService (Phase 4 - í• ë£¨ì‹œë„¤ì´ì…˜ ëŒ€ì‘)
- â­ï¸ Vector/Graph RAG (Phase 4 - ì§€ì‹ ê´€ë¦¬)

---

## í•µì‹¬ ì›ì¹™ (ssot.md ê¸°ë°˜)

### Goal ê¸°ë°˜ ì‘ì—… ë¶„í•´

ssot.md 4.1 ì „ì²´ ì‹¤í–‰ íë¦„ì—ì„œ:

```
ì—…ë¬´ ì‹œì‘
  1. ì¸ê°„ì´ Goal ì„¤ì • ("ì‚¬ìš©ì ì¸ì¦ ê¸°ëŠ¥ êµ¬í˜„")
  2. Goal â†’ Project â†’ Task ìë™ ë¶„í•´  â¬…ï¸ Phase 3 êµ¬í˜„
     - Milestoneì€ Taskì˜ ì„ íƒì  ê·¸ë£¹í•‘ìœ¼ë¡œ ìë™/ìˆ˜ë™ ìƒì„±
  3. Taskê°€ Task Poolì— ë“±ë¡
```

### ë¶ˆí™•ì‹¤ì„± ì˜ì‚¬ê²°ì • (ssot.md 8.5)

**ììœ¨ ê²°ì • ê°€ëŠ¥ ì¡°ê±´** (ëª¨ë‘ ì¶©ì¡± ì‹œ):

1. ë˜ëŒë¦´ ìˆ˜ ìˆëŠ”ê°€? âœ…
2. ë¹„ìš© í•œë„ ë‚´ì¸ê°€? âœ…
3. ì™¸ë¶€ ì˜í–¥ ì—†ëŠ”ê°€? âœ…

í•˜ë‚˜ë¼ë„ No â†’ ğŸ§‘ ì¸ê°„ ì—ìŠ¤ì»¬ë ˆì´ì…˜

**Time-boxed ì‹¤í—˜ (Spike)**: ë¶ˆí™•ì‹¤ì„± í•´ì†Œë¥¼ ìœ„í•´ ì‹œê°„/ë¹„ìš© ì œí•œ ë‚´ ì‹¤í—˜ ìˆ˜í–‰

### Pivot ëŒ€ì‘ (ssot.md 4.5)

```
[ì „ëµ ë³€ê²½] â†’ ì¸ê°„ì´ Pivot ì„ ì–¸
    â”‚
    â”œâ”€ ì˜í–¥ ë¶„ì„ (ììœ¨)              â¬…ï¸ Phase 3 êµ¬í˜„
    â”œâ”€ ì‘ì—… ì¤‘ë‹¨ (ììœ¨)              â¬…ï¸ Phase 3 êµ¬í˜„
    â”œâ”€ ìì‚° ë¶„ë¥˜ (ììœ¨): ì¬í™œìš©/ë³´ê´€/íê¸°
    â””â”€ ìƒˆ ë°©í–¥ ì‹¤í–‰ (ì¸ê°„ ìŠ¹ì¸ í›„)
```

---

## Week 13-14: ëª©í‘œ ê´€ë¦¬ ì‹œìŠ¤í…œ

### Week 13: Goal Entity ë° ë°ì´í„° ëª¨ë¸

#### Day 1-2: Goal Entity ë° ë§ˆì´ê·¸ë ˆì´ì…˜

**ì‘ì—… ëª©ë¡**:

- [ ] `goals` í…Œì´ë¸” ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶”ê°€
- [ ] `goal_key_results` í…Œì´ë¸” ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶”ê°€
- [ ] `goal_progress_records` í…Œì´ë¸” ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶”ê°€

**êµ¬í˜„ ìƒì„¸**:

```sql
-- goals í…Œì´ë¸” (OKR êµ¬ì¡°)
CREATE TABLE goals (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    organization_id UUID NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,
    team_id UUID REFERENCES teams(id) ON DELETE SET NULL,
    parent_goal_id UUID REFERENCES goals(id) ON DELETE SET NULL,

    -- ëª©í‘œ ì •ë³´
    title VARCHAR(500) NOT NULL,
    description TEXT,

    -- OKR íƒ€ì…
    goal_type VARCHAR(20) NOT NULL DEFAULT 'objective'
        CHECK (goal_type IN ('objective', 'key_result')),

    -- ìƒíƒœ
    status VARCHAR(20) NOT NULL DEFAULT 'draft'
        CHECK (status IN ('draft', 'active', 'paused', 'completed', 'cancelled', 'archived')),

    -- ì§„í–‰ë„
    progress_percent DECIMAL(5, 2) DEFAULT 0.0 CHECK (progress_percent >= 0 AND progress_percent <= 100),

    -- ê¸°ê°„
    start_date DATE,
    target_date DATE,
    completed_at TIMESTAMP WITH TIME ZONE,

    -- ìš°ì„ ìˆœìœ„
    priority VARCHAR(20) DEFAULT 'medium'
        CHECK (priority IN ('low', 'medium', 'high', 'critical')),

    -- ì¸¡ì • ê¸°ì¤€
    metric_type VARCHAR(20)
        CHECK (metric_type IN ('binary', 'numeric', 'percentage', 'custom')),
    target_value DECIMAL(15, 4),
    current_value DECIMAL(15, 4) DEFAULT 0,
    unit VARCHAR(50),

    -- ì„±ê³µ ê¸°ì¤€
    success_criteria JSONB DEFAULT '[]',

    -- ì†Œìœ ì
    owner_hollon_id UUID REFERENCES hollons(id) ON DELETE SET NULL,

    -- ìë™ ë¶„í•´ ê´€ë ¨
    auto_decomposed BOOLEAN DEFAULT false,
    decomposition_strategy VARCHAR(50),  -- 'task_based', 'milestone_based', 'hybrid'

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_goals_org ON goals(organization_id);
CREATE INDEX idx_goals_team ON goals(team_id);
CREATE INDEX idx_goals_parent ON goals(parent_goal_id);
CREATE INDEX idx_goals_status ON goals(status);
CREATE INDEX idx_goals_owner ON goals(owner_hollon_id);

-- Key Results (Goalsì˜ í•˜ìœ„ í•­ëª©ìœ¼ë¡œë„ ì‚¬ìš© ê°€ëŠ¥)
CREATE TABLE goal_key_results (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    goal_id UUID NOT NULL REFERENCES goals(id) ON DELETE CASCADE,

    title VARCHAR(500) NOT NULL,
    description TEXT,

    metric VARCHAR(100) NOT NULL,
    target_value DECIMAL(15, 4) NOT NULL,
    current_value DECIMAL(15, 4) DEFAULT 0,
    unit VARCHAR(50),

    -- ì§„í–‰ë„ ìë™ ê³„ì‚°
    progress_percent DECIMAL(5, 2) DEFAULT 0.0,

    status VARCHAR(20) DEFAULT 'active'
        CHECK (status IN ('active', 'completed', 'failed', 'cancelled')),

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_key_results_goal ON goal_key_results(goal_id);

-- Goal ì§„í–‰ë„ ê¸°ë¡ (ì‹œê³„ì—´ ì¶”ì )
CREATE TABLE goal_progress_records (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    goal_id UUID NOT NULL REFERENCES goals(id) ON DELETE CASCADE,

    progress_percent DECIMAL(5, 2) NOT NULL,
    current_value DECIMAL(15, 4),

    note TEXT,
    recorded_by UUID REFERENCES hollons(id) ON DELETE SET NULL,
    recorded_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_goal_progress_goal ON goal_progress_records(goal_id);
CREATE INDEX idx_goal_progress_date ON goal_progress_records(recorded_at DESC);
```

**ê²€ì¦**:

```bash
pnpm exec typeorm migration:generate src/migrations/CreateGoalTables
pnpm exec typeorm migration:run
```

#### Day 3-4: Goal Service êµ¬í˜„

**ì‘ì—… ëª©ë¡**:

- [ ] `src/modules/goal/goal.module.ts` ìƒì„±
- [ ] `src/modules/goal/entities/goal.entity.ts` ìƒì„±
- [ ] `src/modules/goal/entities/goal-key-result.entity.ts` ìƒì„±
- [ ] `src/modules/goal/goal.service.ts` êµ¬í˜„
- [ ] `src/modules/goal/goal.controller.ts` êµ¬í˜„

**GoalService í•µì‹¬ ë©”ì„œë“œ**:

```typescript
@Injectable()
export class GoalService {
  constructor(
    @InjectRepository(Goal)
    private goalRepo: Repository<Goal>,
    @InjectRepository(GoalKeyResult)
    private keyResultRepo: Repository<GoalKeyResult>,
    @InjectRepository(GoalProgressRecord)
    private progressRepo: Repository<GoalProgressRecord>,
  ) {}

  /**
   * Goal ìƒì„±
   */
  async create(dto: CreateGoalDto): Promise<Goal> {
    const goal = this.goalRepo.create({
      ...dto,
      status: 'draft',
      progressPercent: 0,
    });

    return this.goalRepo.save(goal);
  }

  /**
   * Goal ì§„í–‰ë„ ê³„ì‚° (í•˜ìœ„ Task ê¸°ë°˜)
   */
  async calculateProgress(goalId: string): Promise<number> {
    // ê´€ë ¨ Task ì¡°íšŒ
    const tasks = await this.taskRepo.find({
      where: { goalId },
    });

    if (tasks.length === 0) return 0;

    const completedTasks = tasks.filter((t) => t.status === TaskStatus.DONE);
    const progressPercent = (completedTasks.length / tasks.length) * 100;

    // Goal ì—…ë°ì´íŠ¸
    await this.goalRepo.update(goalId, {
      progressPercent,
      currentValue: completedTasks.length,
    });

    // ì§„í–‰ë„ ê¸°ë¡
    await this.progressRepo.save({
      goalId,
      progressPercent,
      currentValue: completedTasks.length,
      recordedAt: new Date(),
    });

    return progressPercent;
  }

  /**
   * Goal ìƒíƒœ ë³€ê²½
   */
  async updateStatus(goalId: string, status: GoalStatus): Promise<Goal> {
    await this.goalRepo.update(goalId, {
      status,
      ...(status === 'completed' && { completedAt: new Date() }),
    });

    return this.findOne(goalId);
  }

  /**
   * í•˜ìœ„ Goal ì¡°íšŒ (ê³„ì¸µ êµ¬ì¡°)
   */
  async getChildren(goalId: string): Promise<Goal[]> {
    return this.goalRepo.find({
      where: { parentGoalId: goalId },
      order: { priority: 'DESC', createdAt: 'ASC' },
    });
  }

  /**
   * Goal ì§„í–‰ë„ íˆìŠ¤í† ë¦¬
   */
  async getProgressHistory(
    goalId: string,
    startDate?: Date,
    endDate?: Date,
  ): Promise<GoalProgressRecord[]> {
    const query = this.progressRepo
      .createQueryBuilder('progress')
      .where('progress.goalId = :goalId', { goalId })
      .orderBy('progress.recordedAt', 'DESC');

    if (startDate) {
      query.andWhere('progress.recordedAt >= :startDate', { startDate });
    }
    if (endDate) {
      query.andWhere('progress.recordedAt <= :endDate', { endDate });
    }

    return query.getMany();
  }
}
```

#### Day 5: Goal Controller ë° API

**ì‘ì—… ëª©ë¡**:

- [ ] REST API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
- [ ] DTO í´ë˜ìŠ¤ ì‘ì„±
- [ ] Swagger ë¬¸ì„œí™”

**API ì—”ë“œí¬ì¸íŠ¸**:

```typescript
@Controller('api/goals')
export class GoalController {
  // POST /api/goals - Goal ìƒì„±
  // GET /api/goals - Organization/Teamì˜ Goal ëª©ë¡
  // GET /api/goals/:id - Goal ìƒì„¸
  // PATCH /api/goals/:id - Goal ì—…ë°ì´íŠ¸
  // DELETE /api/goals/:id - Goal ì‚­ì œ
  // POST /api/goals/:id/activate - Goal í™œì„±í™”
  // GET /api/goals/:id/progress - ì§„í–‰ë„ íˆìŠ¤í† ë¦¬
  // POST /api/goals/:id/key-results - Key Result ì¶”ê°€
}
```

---

### Week 14: Goal ì¶”ì  ë° ë¦¬ë·° ìë™í™”

#### Day 1-2: GoalTrackingService êµ¬í˜„

**ì‘ì—… ëª©ë¡**:

- [ ] `src/modules/goal/services/goal-tracking.service.ts` ìƒì„±
- [ ] ìë™ ì§„í–‰ë„ ì—…ë°ì´íŠ¸ ë¡œì§
- [ ] Key Result ìë™ ê³„ì‚°

**GoalTrackingService**:

```typescript
@Injectable()
export class GoalTrackingService {
  constructor(
    private goalService: GoalService,
    private taskService: TaskService,
    @InjectRepository(Goal)
    private goalRepo: Repository<Goal>,
  ) {}

  /**
   * Goal ì§„í–‰ë„ ìë™ ì—…ë°ì´íŠ¸ (Cron)
   * ë§¤ì‹œê°„ ì‹¤í–‰
   */
  @Cron('0 * * * *') // ë§¤ì‹œê°„
  async updateAllGoalProgress(): Promise<void> {
    const activeGoals = await this.goalRepo.find({
      where: { status: In(['active', 'paused']) },
    });

    for (const goal of activeGoals) {
      try {
        await this.goalService.calculateProgress(goal.id);
      } catch (error) {
        this.logger.error(`Failed to update goal ${goal.id}`, error);
      }
    }
  }

  /**
   * íŠ¹ì • Task ì™„ë£Œ ì‹œ ê´€ë ¨ Goal ì—…ë°ì´íŠ¸
   */
  async onTaskCompleted(taskId: string): Promise<void> {
    const task = await this.taskService.findOne(taskId);

    // Taskì™€ ì—°ê²°ëœ Goalì´ ìˆëŠ”ì§€ í™•ì¸
    // Project â†’ Goal ë§¤í•‘ì„ í†µí•´ ì°¾ìŒ
    const goals = await this.findGoalsByTask(task);

    for (const goal of goals) {
      await this.goalService.calculateProgress(goal.id);

      // 100% ë‹¬ì„± ì‹œ ìë™ ì™„ë£Œ
      if (goal.progressPercent >= 100) {
        await this.goalService.updateStatus(goal.id, 'completed');
      }
    }
  }

  /**
   * ëª©í‘œ ë‹¬ì„± ìœ„í—˜ë„ ë¶„ì„
   */
  async analyzeGoalRisk(goalId: string): Promise<GoalRiskAnalysis> {
    const goal = await this.goalService.findOne(goalId);

    if (!goal.targetDate) {
      return { riskLevel: 'unknown', reason: 'No target date set' };
    }

    const now = new Date();
    const targetDate = new Date(goal.targetDate);
    const totalDays = differenceInDays(targetDate, goal.startDate);
    const elapsedDays = differenceInDays(now, goal.startDate);
    const remainingDays = differenceInDays(targetDate, now);

    const expectedProgress = (elapsedDays / totalDays) * 100;
    const actualProgress = goal.progressPercent;
    const progressGap = actualProgress - expectedProgress;

    let riskLevel: 'low' | 'medium' | 'high' | 'critical';

    if (remainingDays < 0) {
      riskLevel = 'critical'; // ê¸°í•œ ì´ˆê³¼
    } else if (progressGap < -30) {
      riskLevel = 'critical'; // 30% ì´ìƒ ë’¤ì²˜ì§
    } else if (progressGap < -15) {
      riskLevel = 'high';
    } else if (progressGap < -5) {
      riskLevel = 'medium';
    } else {
      riskLevel = 'low';
    }

    return {
      riskLevel,
      progressGap,
      remainingDays,
      expectedProgress,
      actualProgress,
      recommendation: this.getRecommendation(riskLevel, progressGap),
    };
  }

  private getRecommendation(riskLevel: string, progressGap: number): string {
    if (riskLevel === 'critical') {
      return 'Immediate action required. Consider extending deadline or reducing scope.';
    } else if (riskLevel === 'high') {
      return 'Increase priority and allocate more resources.';
    } else if (riskLevel === 'medium') {
      return 'Monitor closely and address blockers.';
    } else {
      return 'On track. Continue current pace.';
    }
  }
}
```

#### Day 3-4: GoalReviewService êµ¬í˜„

**ì‘ì—… ëª©ë¡**:

- [ ] `src/modules/goal/services/goal-review.service.ts` ìƒì„±
- [ ] ì£¼ê°„ Goal ë¦¬ë·° ìë™í™”
- [ ] Document ìë™ ìƒì„±

**GoalReviewService**:

```typescript
@Injectable()
export class GoalReviewService {
  constructor(
    private goalService: GoalService,
    private goalTrackingService: GoalTrackingService,
    private documentService: DocumentService,
  ) {}

  /**
   * ì£¼ê°„ Goal ë¦¬ë·° (ë§¤ì£¼ ê¸ˆìš”ì¼ 17:00)
   */
  @Cron('0 17 * * 5') // ê¸ˆìš”ì¼ 17:00
  async weeklyGoalReview(): Promise<void> {
    const organizations = await this.orgRepo.find();

    for (const org of organizations) {
      try {
        await this.runGoalReview(org.id);
      } catch (error) {
        this.logger.error(`Goal review failed for org ${org.id}`, error);
      }
    }
  }

  /**
   * Organizationì˜ Goal ë¦¬ë·° ì‹¤í–‰
   */
  private async runGoalReview(organizationId: string): Promise<void> {
    const activeGoals = await this.goalRepo.find({
      where: {
        organizationId,
        status: In(['active', 'paused']),
      },
      relations: ['keyResults', 'owner'],
    });

    // ë¦¬ìŠ¤í¬ ë¶„ì„
    const goalsWithRisk = await Promise.all(
      activeGoals.map(async (goal) => ({
        goal,
        risk: await this.goalTrackingService.analyzeGoalRisk(goal.id),
      })),
    );

    // ë¦¬ìŠ¤í¬ ë ˆë²¨ë³„ ë¶„ë¥˜
    const criticalGoals = goalsWithRisk.filter(
      (g) => g.risk.riskLevel === 'critical',
    );
    const highRiskGoals = goalsWithRisk.filter(
      (g) => g.risk.riskLevel === 'high',
    );
    const onTrackGoals = goalsWithRisk.filter(
      (g) => g.risk.riskLevel === 'low',
    );

    // ë¦¬ë·° ë¬¸ì„œ ìƒì„±
    const reviewDocument = this.generateReviewDocument({
      organizationId,
      totalGoals: activeGoals.length,
      criticalGoals,
      highRiskGoals,
      onTrackGoals,
      reviewDate: new Date(),
    });

    // Document ì €ì¥
    await this.documentService.create({
      organizationId,
      name: `Goal Review - ${format(new Date(), 'yyyy-MM-dd')}`,
      docType: 'meeting',
      scope: 'organization',
      scopeId: organizationId,
      content: reviewDocument,
      autoGenerated: true,
      keywords: ['goal', 'review', 'weekly', 'okr'],
      importance: 7,
    });

    // Critical Goalì€ ì¸ê°„ì—ê²Œ ì•Œë¦¼
    if (criticalGoals.length > 0) {
      await this.notifyHumans(organizationId, criticalGoals);
    }
  }

  /**
   * ë¦¬ë·° ë¬¸ì„œ ìƒì„±
   */
  private generateReviewDocument(data: GoalReviewData): string {
    const {
      totalGoals,
      criticalGoals,
      highRiskGoals,
      onTrackGoals,
      reviewDate,
    } = data;

    return `# Weekly Goal Review - ${format(reviewDate, 'yyyy-MM-dd')}

## Executive Summary

- **Total Active Goals**: ${totalGoals}
- **Critical Risk**: ${criticalGoals.length} goals âš ï¸
- **High Risk**: ${highRiskGoals.length} goals
- **On Track**: ${onTrackGoals.length} goals âœ…

## Critical Goals (Immediate Action Required)

${criticalGoals
  .map(
    ({ goal, risk }) => `
### ${goal.title}

- **Progress**: ${goal.progressPercent.toFixed(1)}% (Expected: ${risk.expectedProgress.toFixed(1)}%)
- **Gap**: ${risk.progressGap.toFixed(1)}%
- **Remaining Days**: ${risk.remainingDays}
- **Owner**: ${goal.owner?.name || 'Unassigned'}
- **Recommendation**: ${risk.recommendation}
`,
  )
  .join('\n')}

## High Risk Goals

${highRiskGoals
  .map(
    ({ goal, risk }) => `
- **${goal.title}**: ${goal.progressPercent.toFixed(1)}% (Gap: ${risk.progressGap.toFixed(1)}%)
`,
  )
  .join('\n')}

## On Track Goals

${onTrackGoals
  .slice(0, 5)
  .map(
    ({ goal }) => `
- **${goal.title}**: ${goal.progressPercent.toFixed(1)}%
`,
  )
  .join('\n')}

${onTrackGoals.length > 5 ? `\n... and ${onTrackGoals.length - 5} more goals on track\n` : ''}

## Recommended Actions

${this.generateRecommendations(criticalGoals, highRiskGoals)}

---

*ğŸ¤– Generated automatically by GoalReviewService*
`;
  }

  private generateRecommendations(
    criticalGoals: GoalWithRisk[],
    highRiskGoals: GoalWithRisk[],
  ): string {
    const recommendations: string[] = [];

    if (criticalGoals.length > 0) {
      recommendations.push(
        '1. **Address Critical Goals**: Schedule immediate review meetings for critical goals',
      );
    }

    if (highRiskGoals.length > 0) {
      recommendations.push(
        '2. **Rebalance Priorities**: Increase priority for high-risk goals',
      );
    }

    if (recommendations.length === 0) {
      recommendations.push(
        'All goals are on track. Continue current execution.',
      );
    }

    return recommendations.join('\n');
  }

  /**
   * ì¸ê°„ì—ê²Œ ì•Œë¦¼ (Critical Goals)
   */
  private async notifyHumans(
    organizationId: string,
    criticalGoals: GoalWithRisk[],
  ): Promise<void> {
    // ApprovalRequest ë˜ëŠ” Messageë¥¼ í†µí•´ ì•Œë¦¼
    // êµ¬í˜„ì€ Phase 1-2ì˜ ê¸°ì¡´ íŒ¨í„´ ì‚¬ìš©
  }
}
```

#### Day 5: í…ŒìŠ¤íŠ¸ ì‘ì„±

**ì‘ì—… ëª©ë¡**:

- [ ] `goal.service.spec.ts` - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- [ ] `goal-tracking.service.spec.ts` - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- [ ] `goal-review.service.spec.ts` - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- [ ] `goal.e2e-spec.ts` - E2E í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ëª©í‘œ**: 90% ì´ìƒ

---

## Week 15-16: ëª©í‘œ â†’ íƒœìŠ¤í¬ ë¶„í•´ â­

> **ì£¼ì˜**: ì´ ì£¼ì°¨ëŠ” Phase 3ì—ì„œ ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤. Phase 4 Dogfoodingì˜ í•µì‹¬ ê¸°ëŠ¥ì…ë‹ˆë‹¤.

### Week 15: GoalDecompositionService í•µì‹¬ êµ¬í˜„

#### Day 1-2: GoalDecompositionService ê¸°ë³¸ êµ¬ì¡°

**ì‘ì—… ëª©ë¡**:

- [ ] `src/modules/goal/services/goal-decomposition.service.ts` ìƒì„±
- [ ] Brain Provider ì—°ë™
- [ ] í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì„¤ê³„

**GoalDecompositionService**:

```typescript
@Injectable()
export class GoalDecompositionService {
  constructor(
    private goalService: GoalService,
    private brainProviderFactory: BrainProviderFactory,
    private taskService: TaskService,
    private projectService: ProjectService,
    @InjectRepository(Goal)
    private goalRepo: Repository<Goal>,
  ) {}

  /**
   * Goalì„ Taskë¡œ ìë™ ë¶„í•´
   * Phase 4 Dogfoodingì˜ í•µì‹¬ ê¸°ëŠ¥
   *
   * Input: "Phase 4 ëª©í‘œ: í•™ìŠµ ë° ì„±ì¥ ì‹œìŠ¤í…œ êµ¬ì¶•"
   * Output: 35ê°œ Task + ì˜ì¡´ì„± ê·¸ë˜í”„
   */
  async decomposeGoal(
    goalId: string,
    options?: DecompositionOptions,
  ): Promise<DecompositionResult> {
    const goal = await this.goalService.findOne(goalId);

    // 1. Brain Provider ì„ íƒ
    const brainProvider = await this.brainProviderFactory.getProvider(
      goal.organizationId,
      { preferredModel: 'claude-3.5-sonnet' },
    );

    // 2. ì»¨í…ìŠ¤íŠ¸ ìˆ˜ì§‘ (ê¸°ì¡´ íŒ¨í„´ í¬í•¨)
    const context = await this.gatherContext(goal);
    // context.existingPatterns: ê¸°ì¡´ ì„œë¹„ìŠ¤ íŒ¨í„´ (HollonService, RoleService ë“±)

    // 3. LLM í”„ë¡¬í”„íŠ¸ ìƒì„± ë° ì‹¤í–‰
    const prompt = this.buildDecompositionPrompt(goal, context);
    const llmResponse = await brainProvider.generateText({
      prompt,
      temperature: 0.3, // ì¼ê´€ì„± ì¤‘ì‹œ
      maxTokens: 8000,
    });

    // 4. LLM ì‘ë‹µ íŒŒì‹±
    const decomposition = this.parseDecompositionResponse(llmResponse);

    // 5. Project/Task ìƒì„± (Milestoneì€ ì„ íƒì )
    const result = await this.createWorkItems(goal, decomposition);

    // 6. Goal ì—…ë°ì´íŠ¸
    await this.goalRepo.update(goalId, {
      autoDecomposed: true,
      decompositionStrategy: decomposition.strategy,
    });

    return result;
  }
}
```

#### Day 3-5: í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ë° ìµœì í™”

**ì‘ì—… ëª©ë¡**:

- [ ] í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ A/B í…ŒìŠ¤íŠ¸
- [ ] Few-shot Examples ì¶”ê°€
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ ë° ì¬ì‹œë„ ë¡œì§

---

### Week 16: DependencyAnalyzer ë° ResourcePlanner

#### Day 1-2: DependencyAnalyzer êµ¬í˜„

**ì‘ì—… ëª©ë¡**:

- [ ] `src/modules/task/services/dependency-analyzer.service.ts` ìƒì„±
- [ ] ê·¸ë˜í”„ ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„ (Topological Sort)
- [ ] ë³‘ë ¬ ì‹¤í–‰ ê°€ëŠ¥ Task ê·¸ë£¹í™”

#### Day 3-5: ResourcePlanner êµ¬í˜„

**ì‘ì—… ëª©ë¡**:

- [ ] `src/modules/task/services/resource-planner.service.ts` ìƒì„±
- [ ] Skill ê¸°ë°˜ Hollon ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜
- [ ] ì›Œí¬ë¡œë“œ ë°¸ëŸ°ì‹±

---

## Week 17-18: ë™ì  ìš°ì„ ìˆœìœ„ ë° ì „ëµ ë³€ê²½ ëŒ€ì‘

### Week 17: PriorityRebalancerService êµ¬í˜„

#### Day 1-3: ì‹¤ì‹œê°„ ìš°ì„ ìˆœìœ„ ì¬ì¡°ì •

**ì‘ì—… ëª©ë¡**:

- [ ] `src/modules/task/services/priority-rebalancer.service.ts` ìƒì„±
- [ ] ì§„í–‰ë„ ê¸°ë°˜ ìš°ì„ ìˆœìœ„ ìë™ ì¡°ì •
- [ ] ë³‘ëª© ê°ì§€ ë° ëŒ€ì‘

#### Day 4-5: UncertaintyDecisionService êµ¬í˜„

**ì‘ì—… ëª©ë¡**:

- [ ] `src/modules/decision/services/uncertainty-decision.service.ts` ìƒì„±
- [ ] ë¶ˆí™•ì‹¤ì„± ê°ì§€ ë¡œì§
- [ ] Spike Task ìë™ ìƒì„±

---

### Week 18: PivotResponseService êµ¬í˜„

#### Day 1-3: ì „ëµ ë³€ê²½ ëŒ€ì‘ ì‹œìŠ¤í…œ

**ì‘ì—… ëª©ë¡**:

- [ ] `src/modules/pivot/pivot.module.ts` ìƒì„±
- [ ] `src/modules/pivot/entities/pivot.entity.ts` ìƒì„±
- [ ] `src/modules/pivot/services/pivot-response.service.ts` êµ¬í˜„

#### Day 4-5: Pivot API ë° í…ŒìŠ¤íŠ¸

**ì‘ì—… ëª©ë¡**:

- [ ] `src/modules/pivot/pivot.controller.ts` êµ¬í˜„
- [ ] Pivot REST API
- [ ] E2E í…ŒìŠ¤íŠ¸

---

## Week 19: í†µí•© í…ŒìŠ¤íŠ¸ ë° Phase 4 ì¤€ë¹„

### Week 19 Day 1-3: End-to-End ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸

**ì‘ì—… ëª©ë¡**:

- [ ] `phase3-e2e.spec.ts` ì‘ì„±
- [ ] Goal â†’ Task ë¶„í•´ ì „ì²´ íë¦„ í…ŒìŠ¤íŠ¸
- [ ] Pivot ì „ì²´ íë¦„ í…ŒìŠ¤íŠ¸

**E2E í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:

```typescript
describe('Phase 3 E2E: Goal Decomposition to Execution', () => {
  it('should decompose Phase 4 goal into 35 tasks and assign to 5 hollons', async () => {
    // 1. Goal ìƒì„±
    const goal = await goalService.create({
      organizationId: testOrg.id,
      teamId: testTeam.id,
      title: 'Phase 4: Learning & Growth System',
      description:
        'Implement hollon onboarding, knowledge management, and performance analysis',
      goalType: 'objective',
      targetDate: addWeeks(new Date(), 8),
      priority: 'high',
    });

    // 2. Goal ë¶„í•´
    const decomposition = await goalDecompositionService.decomposeGoal(goal.id);

    expect(decomposition.tasksCreated).toBeGreaterThanOrEqual(30);
    expect(decomposition.tasksCreated).toBeLessThanOrEqual(50);
    expect(decomposition.projectsCreated).toBeGreaterThanOrEqual(1);

    // 3. ì˜ì¡´ì„± ë¶„ì„
    const analysis = await dependencyAnalyzer.analyzeProject(
      decomposition.projects[0].id,
    );

    expect(analysis.executionOrder.length).toBe(decomposition.tasksCreated);
    expect(analysis.criticalPath.tasks.length).toBeGreaterThan(0);

    // 4. Hollon í• ë‹¹
    const assignment = await resourcePlanner.assignProject(
      decomposition.projects[0].id,
    );

    expect(assignment.assignedTasks).toBeGreaterThan(20);
    expect(assignment.unassignedTasks).toBeLessThan(5);

    // 5. ìš°ì„ ìˆœìœ„ ì¬ì¡°ì •
    const rebalance = await priorityRebalancerService.rebalanceProject(
      decomposition.projects[0].id,
    );

    expect(rebalance.totalAdjustments).toBeGreaterThan(0);

    // 6. Goal ì§„í–‰ë„ ì¶”ì 
    await goalTrackingService.updateAllGoalProgress();

    const updatedGoal = await goalService.findOne(goal.id);
    expect(updatedGoal.progressPercent).toBe(0); // ì•„ì§ Task ì™„ë£Œ ì•ˆë¨
  });

  it('should handle strategic pivot with asset classification', async () => {
    // 1. í”„ë¡œì íŠ¸ ë° Task ìƒì„±
    const project = await projectService.create({
      organizationId: testOrg.id,
      teamId: testTeam.id,
      name: 'Old Direction Project',
      description: 'Original strategic direction',
      status: 'in_progress',
    });

    const tasks = await Promise.all([
      taskService.create({
        projectId: project.id,
        title: 'Completed Task',
        status: TaskStatus.DONE,
      }),
      taskService.create({
        projectId: project.id,
        title: 'In Progress Task',
        status: TaskStatus.IN_PROGRESS,
      }),
      taskService.create({
        projectId: project.id,
        title: 'Ready Task',
        status: TaskStatus.READY,
      }),
    ]);

    // 2. Pivot ì„ ì–¸
    const pivot = await pivotResponseService.declarePivot({
      organizationId: testOrg.id,
      projectId: project.id,
      title: 'Strategic Pivot',
      description: 'Old direction description',
      newDirection: 'New strategic direction',
      reason: 'Market feedback indicates different approach needed',
      proposedBy: 'user-123',
    });

    expect(pivot.impactAnalysis.affectedTasks).toBe(3);
    expect(pivot.assetClassification).toBeDefined();

    // 3. Pivot ìŠ¹ì¸ ë° ì‹¤í–‰
    await pivotResponseService.executePivot(pivot.id, 'user-123');

    // 4. ìì‚° ìƒíƒœ ê²€ì¦
    const updatedTasks = await taskService.findByProject(project.id);

    const completedTask = updatedTasks.find(
      (t) => t.title === 'Completed Task',
    );
    expect(completedTask.status).toBe(TaskStatus.DONE); // Reused

    const inProgressTask = updatedTasks.find(
      (t) => t.title === 'In Progress Task',
    );
    expect(inProgressTask.status).toBe(TaskStatus.CANCELLED); // Stopped
  });
});
```

### Week 19 Day 4-5: Phase 4 Readiness ê²€ì¦

**ì‘ì—… ëª©ë¡**:

- [ ] Phase 4 Dogfooding ì¤€ë¹„ ìƒíƒœ ê²€ì¦
- [ ] 6ê°€ì§€ í•„ìˆ˜ ì„œë¹„ìŠ¤ ë™ì‘ í™•ì¸
- [ ] ë¬¸ì„œí™” ì™„ë£Œ

**ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸**:

```typescript
describe('Phase 4 Dogfooding Readiness', () => {
  it('âœ… GoalDecompositionService: should auto-generate 35 tasks from high-level goal', async () => {
    const goal = await createPhase4Goal();
    const result = await goalDecompositionService.decomposeGoal(goal.id);

    expect(result.tasksCreated).toBeGreaterThanOrEqual(30);
  });

  it('âœ… DependencyAnalyzer: should create accurate dependency graph', async () => {
    const project = await createTestProject();
    const analysis = await dependencyAnalyzer.analyzeProject(project.id);

    expect(analysis.executionOrder).toBeDefined();
    expect(analysis.criticalPath).toBeDefined();
  });

  it('âœ… ResourcePlanner: should match tasks to hollon skills', async () => {
    const project = await createTestProject();
    const assignment = await resourcePlanner.assignProject(project.id);

    expect(assignment.assignedTasks).toBeGreaterThan(0);
  });

  it('âœ… PriorityRebalancerService: should adjust priorities in real-time', async () => {
    const project = await createTestProject();
    const result = await priorityRebalancerService.rebalanceProject(project.id);

    expect(result.totalAdjustments).toBeGreaterThan(0);
  });

  it('âœ… UncertaintyDecisionService: should handle technical decisions via Spike tasks', async () => {
    const task = await createTestTask();
    const result = await uncertaintyDecisionService.detectUncertainty(task.id, {
      unknownTechnology: 'WebRTC',
    });

    expect(result.hasUncertainty).toBe(true);
    expect(result.decision).toBe('create_spike');
  });

  it('âœ… PivotResponseService: should analyze strategy change impacts', async () => {
    const pivot = await pivotResponseService.declarePivot({
      organizationId: testOrg.id,
      title: 'Test Pivot',
      description: 'Old',
      newDirection: 'New',
      reason: 'Test',
      proposedBy: 'user-123',
    });

    expect(pivot.impactAnalysis).toBeDefined();
    expect(pivot.assetClassification).toBeDefined();
  });
});
```

---

## ë§ˆë¬´ë¦¬

### ì™„ë£Œ ê¸°ì¤€ ì¬í™•ì¸

Phase 3 ì™„ë£Œ ì‹œ:

- [x] **ëª©í‘œ ì…ë ¥ â†’ í”„ë¡œì íŠ¸/íƒœìŠ¤í¬ ìë™ ìƒì„±** (GoalDecompositionService)
  - Milestoneì€ ì„ íƒì  ê·¸ë£¹í•‘
- [x] **Task ì˜ì¡´ì„± ìë™ ë¶„ì„ ë° ì‹¤í–‰ ìˆœì„œ ê²°ì •** (DependencyAnalyzer)
- [x] **Hollon ì—­ëŸ‰ ê¸°ë°˜ ìë™ í• ë‹¹** (ResourcePlanner)
- [x] **ì‹¤ì‹œê°„ ì§„í–‰ë„ ëª¨ë‹ˆí„°ë§ ë° ìš°ì„ ìˆœìœ„ ì¬ì¡°ì •** (PriorityRebalancerService)
- [x] **ë¶ˆí™•ì‹¤ì„± ìë™ ê°ì§€ ë° Spike ìƒì„±** (UncertaintyDecisionService)
- [x] **í”¼ë²— ì„ ì–¸ ì‹œ ì˜í–¥ ë¶„ì„ ìë™í™”** (PivotResponseService)

### Phase 4 Dogfooding ì¤€ë¹„ ì™„ë£Œ

Phase 3ê°€ ì™„ë£Œë˜ë©´:

1. âœ… "Phase 4: Learning & Growth" ëª©í‘œ ì…ë ¥
2. âœ… GoalDecompositionServiceê°€ 35ê°œ Task ìë™ ìƒì„±
3. âœ… DependencyAnalyzerê°€ ì˜ì¡´ì„± ê·¸ë˜í”„ ìƒì„±
4. âœ… ResourcePlannerê°€ 5ëª…ì˜ Hollonì—ê²Œ ìë™ í• ë‹¹
5. âœ… í™€ë¡  íŒ€ì´ 75-80% ììœ¨ì„±ìœ¼ë¡œ Phase 4 ê°œë°œ ì‹œì‘
6. âœ… ì¸ê°„ì€ ì£¼ 5-8ì‹œê°„ë§Œ Spot Check ë° ìµœì¢… ìŠ¹ì¸

**ë‹¤ìŒ ë‹¨ê³„**: [phase4-dogfood-plan.md](./phase4-dogfood-plan.md)ë¡œ ì´ë™í•˜ì—¬ Dogfooding 2 ì‹¤í–‰

---

_ğŸ¤– This is the complete Phase 3 implementation plan ensuring Phase 4 Dogfooding readiness._
