# ğŸš€ Phase 4 (ìˆ˜ì •): ì§€ì‹ ì‹œìŠ¤í…œ + í˜‘ì—… + ë©”ëª¨ë¦¬

> **ìˆ˜ì •ì¼**: 2025-12-12
> **ëª©í‘œ**: ì§€ì‹ ì‹œìŠ¤í…œ ê¸°ë°˜ í•™ìŠµ, ì—ì´ì „íŠ¸ ê°„ í˜‘ì—… ê°•í™”, ë©”ëª¨ë¦¬ ì‹œìŠ¤í…œ ê³ ë„í™”
> **ê¸°ê°„**: 6ì£¼ (ê¸°ì¡´ 4ì£¼ â†’ 6ì£¼ë¡œ í™•ì¥)
> **ìš°ì„ ìˆœìœ„**: Phase 3ì—ì„œ ë¯¸ë£¬ í˜‘ì—… ê¸°ëŠ¥ + ì›ë˜ Phase 4 ì§€ì‹ ì‹œìŠ¤í…œ

---

## ğŸ“– ëª©ì°¨

1. [ë³€ê²½ ì‚¬í•­ ìš”ì•½](#-ë³€ê²½-ì‚¬í•­-ìš”ì•½)
2. [Phase 4 ëª©í‘œ](#-phase-4-ëª©í‘œ)
3. [ì£¼ì°¨ë³„ ê³„íš](#-ì£¼ì°¨ë³„-ê³„íš)
4. [Phase 3ì—ì„œ ì´ì›”ëœ ê¸°ëŠ¥](#-phase-3ì—ì„œ-ì´ì›”ëœ-ê¸°ëŠ¥)
5. [ì„±ê³µ ê¸°ì¤€](#-ì„±ê³µ-ê¸°ì¤€)

---

## ğŸ¯ ë³€ê²½ ì‚¬í•­ ìš”ì•½

### ê¸°ì¡´ Phase 4 (4ì£¼)

```
Week 1-2: Knowledge Extraction & Vector RAG
Week 3-4: Self-Improvement Loop
```

### ìˆ˜ì •ëœ Phase 4 (6ì£¼, 3ê°œ ìŠ¤í”„ë¦°íŠ¸)

```
Phase 4.1 (Week 1-2): ì§€ì‹ ì‹œìŠ¤í…œ (Knowledge Extraction + Vector/Graph RAG)
Phase 4.2 (Week 3-4): ì‹¤ì‹œê°„ í˜‘ì—… ì¸í”„ë¼ (Channel + ContinuousImprovement)
Phase 4.3 (Week 5-6): ë©”ëª¨ë¦¬ ë° ìê¸° ê°œì„  (Performance + Prompt Optimization)
```

### ì£¼ìš” ë³€ê²½ì 

| ë³€ê²½ ë‚´ìš©                | ì´ìœ                        | ì˜í–¥                   |
| ------------------------ | -------------------------- | ---------------------- |
| **2ì£¼ í™•ì¥** (4ì£¼ â†’ 6ì£¼) | Channel + ìë™ íšŒì˜ ì¶”ê°€   | Phase 4 ì™„ì„±ë„ í–¥ìƒ    |
| **í˜‘ì—… ì‹œìŠ¤í…œ ì¶”ê°€**     | Phase 3ì—ì„œ ë¯¸ë£¬ ê¸°ëŠ¥ í†µí•© | SSOT Â§ 4.4, Â§ 8.2 ë‹¬ì„± |
| **ìˆœì„œ ì¬ì¡°ì •**          | ì§€ì‹ â†’ í˜‘ì—… â†’ ìµœì í™”       | ë…¼ë¦¬ì  ìˆœì„œ            |

---

## ğŸ¯ Phase 4 ëª©í‘œ

### í•µì‹¬ ëª©í‘œ

**í™€ë¡ ì´ ê²½í—˜ì—ì„œ í•™ìŠµí•˜ê³ , íš¨ê³¼ì ìœ¼ë¡œ í˜‘ì—…í•˜ë©°, ìŠ¤ìŠ¤ë¡œ ê°œì„ í•˜ëŠ” ì‹œìŠ¤í…œ êµ¬ì¶•**

### ì„¸ë¶€ ëª©í‘œ

1. **ì§€ì‹ ì‹œìŠ¤í…œ** (Week 1-2)
   - Task ì™„ë£Œ ì‹œ ìë™ Document ìƒì„± (100%)
   - Vector similarity search (ì •í™•ë„ 85%+)
   - Knowledge Graphë¥¼ í†µí•œ ë¬¸ì„œ ê´€ê³„ ì¶”ì 

2. **ì‹¤ì‹œê°„ í˜‘ì—… ì¸í”„ë¼** (Phase 4.2, Week 3-4)
   - Channel ê¸°ë°˜ ê·¸ë£¹ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜
   - ContinuousImprovementService (ì‹¤ì‹œê°„ ì„±ê³¼ ë¶„ì„)
   - Task ì™„ë£Œ ì‹œ ì¦‰ì‹œ í•™ìŠµ
   - Message ê¸°ë°˜ ë¹„ë™ê¸° í˜‘ì—… ê°•í™”

3. **ìê¸° ê°œì„ ** (Week 5-6)
   - ì„±ê³¼ ë¶„ì„ (PerformanceAnalyzer)
   - Prompt ìµœì í™” (í† í° 15% ì ˆê°)
   - ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ í•™ìŠµ ë° ì ìš©

### SSOT ë‹¬ì„±ë„

| SSOT í•­ëª©            | ìƒíƒœ    | Phase 4 ì™„ë£Œ ì‹œ |
| -------------------- | ------- | --------------- |
| Â§ 5.6 í•˜ì´ë¸Œë¦¬ë“œ RAG | âŒ      | âœ… ì™„ë£Œ         |
| Â§ 4.4 í˜‘ì—… íë¦„      | âš ï¸ ë¶€ë¶„ | âœ… ì™„ë£Œ         |
| Â§ 6.6 í™€ë¡  ì„±ê³¼ í‰ê°€ | âŒ      | âœ… ì™„ë£Œ         |
| Â§ 7.3 ì§€ì†ì  ê°œì„     | âŒ      | âœ… ì™„ë£Œ         |

---

## ğŸ“… ì£¼ì°¨ë³„ ê³„íš

### Phase 4.1 (Week 1-2): ì§€ì‹ ì‹œìŠ¤í…œ êµ¬ì¶•

#### ëª©í‘œ

Task ì™„ë£Œ í›„ ìë™ìœ¼ë¡œ ì§€ì‹ì´ ì¶•ì ë˜ê³ , ë‹¤ìŒ Task ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ ì°¸ì¡°ë˜ëŠ” ì‹œìŠ¤í…œ

#### êµ¬í˜„ ë‚´ìš©

**1. KnowledgeExtractionService**

```typescript
// apps/server/src/modules/knowledge/services/knowledge-extraction.service.ts

@Injectable()
export class KnowledgeExtractionService {
  // Task ì™„ë£Œ ì‹œ ìë™ í˜¸ì¶œ
  async extractFromCompletedTask(task: Task): Promise<Document> {
    const keywords = await this.extractKeywords(task);
    const summary = await this.generateSummary(task);

    return await this.documentService.create({
      title: `Task Completion: ${task.title}`,
      content: summary,
      docType: 'knowledge',
      scope: task.projectId ? 'project' : 'team',
      scopeId: task.projectId || task.assignedHollon.teamId,
      keywords,
      autoGenerated: true,
      importance: this.calculateImportance(task),
    });
  }

  // Decision Log â†’ Document
  async extractFromDecisionLog(log: DecisionLog): Promise<Document>;

  // PR Review â†’ Document
  async extractFromPRReview(pr: TaskPullRequest): Promise<Document>;
}
```

**2. VectorSearchService**

```typescript
// apps/server/src/modules/knowledge/services/vector-search.service.ts

@Injectable()
export class VectorSearchService {
  // OpenAI embedding API ì—°ë™
  async generateEmbedding(text: string): Promise<number[]> {
    const response = await openai.embeddings.create({
      model: 'text-embedding-3-small',
      input: text,
    });
    return response.data[0].embedding;
  }

  // Cosine similarity search (pgvector)
  async vectorSimilaritySearch(
    query: string,
    options: {
      scope?: 'organization' | 'team' | 'project' | 'hollon';
      scopeId?: string;
      limit?: number;
    },
  ): Promise<Document[]> {
    const embedding = await this.generateEmbedding(query);

    return await this.documentRepository
      .createQueryBuilder('doc')
      .select()
      .where('doc.scope = :scope', { scope: options.scope })
      .orderBy('doc.embedding <=> :embedding') // pgvector cosine distance
      .setParameter('embedding', `[${embedding.join(',')}]`)
      .limit(options.limit || 10)
      .getMany();
  }
}
```

**3. KnowledgeGraphService**

```typescript
// apps/server/src/modules/knowledge/services/knowledge-graph.service.ts

// DocumentRelationship Entity ìƒì„±
@Entity('document_relationships')
export class DocumentRelationship {
  @PrimaryColumn() fromDocumentId: string;
  @PrimaryColumn() toDocumentId: string;
  @Column() relationType:
    | 'references'
    | 'depends_on'
    | 'supersedes'
    | 'related_to';
  @Column({ type: 'jsonb', nullable: true }) metadata: any;
}

@Injectable()
export class KnowledgeGraphService {
  // ë¬¸ì„œ ê°„ ê´€ê³„ ìë™ ì¶”ì¶œ
  async extractRelationships(document: Document): Promise<void>;

  // ê´€ê³„ ê¸°ë°˜ ë¬¸ì„œ íƒìƒ‰ (Graph RAG)
  async findRelatedDocuments(
    documentId: string,
    depth: number = 2,
  ): Promise<Document[]>;
}
```

**4. PromptComposerService í†µí•©**

```typescript
// apps/server/src/modules/orchestration/services/prompt-composer.service.ts

// ê¸°ì¡´ ILIKE ê²€ìƒ‰ â†’ Vector + Graph í•˜ì´ë¸Œë¦¬ë“œë¡œ ë³€ê²½
async fetchRelevantMemories(
  task: Task,
  hollon: Hollon
): Promise<Document[]> {
  // 1. Vector search (ì˜ë¯¸ì  ìœ ì‚¬ë„)
  const vectorResults = await this.vectorSearchService.vectorSimilaritySearch(
    task.title + ' ' + task.description,
    { scope: 'project', scopeId: task.projectId, limit: 5 }
  );

  // 2. Graph search (ê´€ê³„ ê¸°ë°˜)
  const graphResults = await this.knowledgeGraphService.findRelatedDocuments(
    task.parentTaskId, // ë¶€ëª¨ Taskì˜ Document ì°¸ì¡°
    2 // depth
  );

  // 3. RRF (Reciprocal Rank Fusion) ë³‘í•©
  return this.mergeResults(vectorResults, graphResults);
}
```

#### í…ŒìŠ¤íŠ¸

- `knowledge-extraction.service.spec.ts` (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)
- `vector-search.service.spec.ts` (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)
- `knowledge-graph.service.spec.ts` (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)
- `phase4.1-knowledge-system.e2e-spec.ts` (E2E í…ŒìŠ¤íŠ¸)

#### ì„±ê³µ ê¸°ì¤€

- [ ] Task ì™„ë£Œ ì‹œ Document ìë™ ìƒì„± (100%)
- [ ] Vector search ì •í™•ë„ 85%+
- [ ] Graph traversal ì •í™•ë„ 80%+
- [ ] PromptComposerService í†µí•© ì™„ë£Œ

---

### Phase 4.2 (Week 3-4): ì‹¤ì‹œê°„ í˜‘ì—… ì¸í”„ë¼

#### ëª©í‘œ

í™€ë¡ ë“¤ì´ Channelì„ í†µí•´ íš¨ê³¼ì ìœ¼ë¡œ ì†Œí†µí•˜ê³ , ì‹¤ì‹œê°„ìœ¼ë¡œ ì„±ê³¼ë¥¼ ë¶„ì„í•˜ì—¬ ì§€ì†ì ìœ¼ë¡œ ê°œì„ 

#### Phase 3ì—ì„œ ì´ì›”ëœ ê¸°ëŠ¥

- **Channel (ê·¸ë£¹ ì±„íŒ…)**: SSOT Â§ 3 (í•µì‹¬ ì—”í‹°í‹°)
- **í˜‘ì—… íë¦„**: SSOT Â§ 4.4 (í˜‘ì—… íë¦„)

#### ì£¼ìš” ë³€ê²½ ì‚¬í•­ âš ï¸

- âŒ **StandupService ì œê±°**: ë§¤ì¼ íšŒì˜ëŠ” ë¶ˆí•„ìš”í•œ Brain Provider í˜¸ì¶œ
- âŒ **RetrospectiveService ì œê±°**: ì£¼ê¸°ì  íšŒê³ ëŠ” AIì—ê²Œ ë¹„íš¨ìœ¨ì 
- âœ… **ContinuousImprovementService ì¶”ê°€**: ì‹¤ì‹œê°„ ì„±ê³¼ ë¶„ì„ ë° ê°œì„ 

#### êµ¬í˜„ ë‚´ìš©

**1. Channel Entity ë° Service**

```typescript
// apps/server/src/modules/channel/entities/channel.entity.ts

@Entity('channels')
export class Channel {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @Column()
  name: string; // "general", "incidents", "team-updates", etc.

  @Column()
  description: string;

  @ManyToOne(() => Team)
  team: Team;

  @ManyToMany(() => Hollon)
  @JoinTable()
  members: Hollon[];

  @Column({ default: 'public' })
  visibility: 'public' | 'private';

  @Column({ type: 'jsonb', nullable: true })
  metadata: any;
}

@Entity('channel_messages')
export class ChannelMessage {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @ManyToOne(() => Channel)
  channel: Channel;

  @ManyToOne(() => Hollon)
  sender: Hollon;

  @Column({ type: 'text' })
  content: string;

  @Column({ type: 'jsonb', nullable: true })
  metadata: any;

  @CreateDateColumn()
  createdAt: Date;
}
```

**2. ContinuousImprovementService (ì •ê¸° íšŒì˜ ëŒ€ì²´)**

```typescript
// apps/server/src/modules/improvement/services/continuous-improvement.service.ts

@Injectable()
export class ContinuousImprovementService {
  /**
   * ë§¤ì¼ ìë™ ì‹¤í–‰ (ìƒˆë²½ 2ì‹œ - ë¶€í•˜ ì ì€ ì‹œê°„)
   * StandupService ëŒ€ì²´: íšŒì˜ ëŒ€ì‹  ë©”íŠ¸ë¦­ ê¸°ë°˜ ë¶„ì„
   */
  @Cron('0 2 * * *')
  async analyzeDailyPerformance() {
    const teams = await this.teamService.findAll();

    for (const team of teams) {
      // 1. ë©”íŠ¸ë¦­ ìˆ˜ì§‘ (DB ì¿¼ë¦¬ë§Œ, Brain Provider í˜¸ì¶œ ì—†ìŒ)
      const metrics = await this.collectMetrics(team, 'daily');

      // 2. Threshold ì²´í¬
      if (this.needsImprovement(metrics)) {
        // 3. ë¬¸ì œ íŒ¨í„´ ë¶„ì„ (LLM ì‚¬ìš©ì€ ì—¬ê¸°ë§Œ)
        const patterns = await this.analyzePatterns(metrics);

        // 4. ê°œì„  ì•¡ì…˜ ìë™ ìƒì„±
        await this.createImprovementTasks(patterns.recommendations, team);

        // 5. Channelì— ì•Œë¦¼ (ì¤‘ìš”í•œ ê²½ìš°ë§Œ)
        if (patterns.severity === 'high') {
          await this.notifyTeam(team, patterns);
        }
      }
    }
  }

  /**
   * Task ì™„ë£Œ ì‹œ ì¦‰ì‹œ ë¶„ì„
   * RetrospectiveService ëŒ€ì²´: ì£¼ê¸°ì  íšŒê³  ëŒ€ì‹  ì‹¤ì‹œê°„ í•™ìŠµ
   */
  @OnEvent('task.completed')
  async onTaskCompleted(event: { task: Task; hollon: Hollon }) {
    const { task, hollon } = event;

    // 1. ì§€ì‹ ì¶”ì¶œ (ì¦‰ì‹œ)
    await this.knowledgeExtractionService.extractFromTask(task);

    // 2. ì„±ê³¼ ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
    await this.performanceAnalyzer.updateMetrics(hollon.id, task);

    // 3. ë°˜ë³µ íŒ¨í„´ ê°ì§€
    const repeatedIssues = await this.detectRepeatedPatterns(task);
    if (repeatedIssues.length > 0) {
      await this.createPreventionTask(repeatedIssues, hollon.teamId);
    }

    // 4. Prompt íš¨ê³¼ ë¶„ì„ (ì„±ê³µ/ì‹¤íŒ¨ ì¼€ì´ìŠ¤ í•™ìŠµ)
    await this.promptOptimizer.analyzePromptEffectiveness(task);
  }

  /**
   * ë©”íŠ¸ë¦­ ìˆ˜ì§‘ (DB ì¿¼ë¦¬ë§Œ)
   */
  private async collectMetrics(team: Team, period: 'daily' | 'weekly') {
    const startDate =
      period === 'daily' ? subDays(new Date(), 1) : subWeeks(new Date(), 1);

    return {
      completedTasks: await this.taskService.countCompleted(team.id, startDate),
      avgCompletionTime: await this.taskService.avgCompletionTime(
        team.id,
        startDate,
      ),
      escalationRate: await this.taskService.escalationRate(team.id, startDate),
      blockedTasks: await this.taskService.countBlocked(team.id),
      incidentCount: await this.incidentService.count(team.id, startDate),
    };
  }

  /**
   * ê°œì„  í•„ìš” ì—¬ë¶€ íŒë‹¨ (Threshold ê¸°ë°˜)
   */
  private needsImprovement(metrics: any): boolean {
    return (
      metrics.escalationRate > 0.3 || // 30% ì´ìƒ escalation
      metrics.blockedTasks > 5 || // 5ê°œ ì´ìƒ blocked
      metrics.incidentCount > 3 // 3ê°œ ì´ìƒ incident
    );
  }

  /**
   * íŒ¨í„´ ë¶„ì„ (LLM ì‚¬ìš©)
   */
  private async analyzePatterns(metrics: any) {
    const response = await this.brainProvider.executeWithTracking({
      systemPrompt: 'You are a performance analyst for an AI team.',
      userPrompt: `Analyze the following metrics and identify patterns:
        
        Metrics:
        - Completed Tasks: ${metrics.completedTasks}
        - Avg Completion Time: ${metrics.avgCompletionTime}h
        - Escalation Rate: ${metrics.escalationRate * 100}%
        - Blocked Tasks: ${metrics.blockedTasks}
        - Incidents: ${metrics.incidentCount}
        
        Provide:
        1. Root cause analysis
        2. Specific recommendations
        3. Severity (low/medium/high)`,
      hollon: null,
    });

    return JSON.parse(response.output);
  }

  /**
   * íŒ€ì— ì•Œë¦¼ (Channel ì‚¬ìš©)
   */
  private async notifyTeam(team: Team, patterns: any) {
    const generalChannel = await this.channelService.findOrCreate(
      team,
      'team-updates',
    );

    await this.channelService.postMessage(generalChannel, {
      sender: null, // ì‹œìŠ¤í…œ ë©”ì‹œì§€
      content: `âš ï¸ **Performance Alert**\n\n${patterns.summary}\n\n**Recommendations:**\n${patterns.recommendations.map((r) => `- ${r}`).join('\n')}`,
      metadata: { type: 'performance-alert', severity: patterns.severity },
    });
  }
}
```

**3. MessageListener ê°œì„  (Channel í†µí•©)**

```typescript
// apps/server/src/modules/message/listeners/message.listener.ts

@Injectable()
export class MessageListener {
  @OnEvent('channel.message.created')
  async handleChannelMessage(event: {
    channel: Channel;
    message: ChannelMessage;
  }) {
    // Incident Channel ìë™ ì²˜ë¦¬
    if (event.channel.name === 'incidents') {
      await this.incidentService.handleIncidentNotification(event.message);
    }

    // í‚¤ì›Œë“œ ê¸°ë°˜ ìë™ ì‘ë‹µ
    if (event.channel.metadata?.autoReply) {
      await this.autoReplyService.processMessage(event.message);
    }
  }

  @OnEvent('message.created')
  async handleDirectMessage(event: { message: Message }) {
    // ê¸°ì¡´ 1:1 Message ì²˜ë¦¬ (Phase 2)
    const { message } = event;

    if (message.toHollon) {
      await this.notifyHollon(message.toHollon, message);
    }
  }
}
```

#### í…ŒìŠ¤íŠ¸

- `channel.service.spec.ts` (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)
- `continuous-improvement.service.spec.ts` (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)
- `phase4.2-collaboration.e2e-spec.ts` (E2E í…ŒìŠ¤íŠ¸)

#### ì„±ê³µ ê¸°ì¤€

- [ ] Channel ìƒì„± ë° ë©”ì‹œì§€ ì „ì†¡ ê¸°ëŠ¥
- [ ] ContinuousImprovementService ë§¤ì¼ ì‹¤í–‰ (ìƒˆë²½ 2ì‹œ)
- [ ] Task ì™„ë£Œ ì‹œ ì‹¤ì‹œê°„ ë¶„ì„ ë° í•™ìŠµ
- [ ] Threshold ì´ˆê³¼ ì‹œ ìë™ ê°œì„  Task ìƒì„±
- [ ] ì¤‘ìš” ì•Œë¦¼ Channel ì „ì†¡

#### ê¸°ì¡´ ê³„íšê³¼ì˜ ì°¨ì´ì 

| ê¸°ì¡´ (íšŒì˜ ê¸°ë°˜)                    | ìˆ˜ì • (ì‹¤ì‹œê°„ ë¶„ì„)                        |
| ----------------------------------- | ----------------------------------------- |
| StandupService (ë§¤ì¼ 09:00)         | ContinuousImprovementService (ë§¤ì¼ 02:00) |
| ëª¨ë“  Hollonì—ê²Œ Brain Provider í˜¸ì¶œ | Threshold ì´ˆê³¼ ì‹œë§Œ LLM ì‚¬ìš©              |
| ìˆ˜ë™ ìƒíƒœ ë³´ê³  ìš”ì²­                 | DB ë©”íŠ¸ë¦­ ìë™ ìˆ˜ì§‘                       |
| RetrospectiveService (ì‚¬ì´í´ ì¢…ë£Œ)  | Task ì™„ë£Œ ì‹œ ì¦‰ì‹œ í•™ìŠµ                    |
| ì£¼ê¸°ì  íšŒê³  (ë¹„ìš© ë†’ìŒ)             | ì´ë²¤íŠ¸ ê¸°ë°˜ ë¶„ì„ (ë¹„ìš© ë‚®ìŒ)              |

---

### Phase 4.3 (Week 5-6): ë©”ëª¨ë¦¬ ë° ìê¸° ê°œì„ 

#### ëª©í‘œ

í™€ë¡ ì´ ìŠ¤ìŠ¤ë¡œ ì„±ê³¼ë¥¼ ë¶„ì„í•˜ê³ , Promptë¥¼ ìµœì í™”í•˜ë©°, ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ë¥¼ í•™ìŠµ

#### êµ¬í˜„ ë‚´ìš©

**1. PerformanceAnalyzer**

```typescript
// apps/server/src/modules/performance/services/performance-analyzer.service.ts

@Injectable()
export class PerformanceAnalyzer {
  // Task ì™„ë£Œ ì‹œ ìë™ í˜¸ì¶œ
  async analyzeTaskCompletion(hollonId: string, taskId: string) {
    const task = await this.taskService.findOne(taskId);
    const hollon = await this.hollonService.findOne(hollonId);

    // 1. ë©”íŠ¸ë¦­ ìˆ˜ì§‘
    const metrics = {
      duration: task.completedAt - task.startedAt,
      estimatedDuration: task.estimatedDuration,
      qualityScore: await this.calculateQualityScore(task),
      escalations: task.escalations?.length || 0,
      reviewCycles: task.reviewCount || 0,
    };

    // 2. ì„±ê³¼ ë¶„ì„
    const performance = {
      speed: metrics.duration / metrics.estimatedDuration, // < 1 = ë¹ ë¦„
      quality: metrics.qualityScore, // 0-100
      collaboration: this.analyzeCollaboration(task),
    };

    // 3. HollonPerformanceSummary ì—…ë°ì´íŠ¸
    await this.updatePerformanceSummary(hollon, performance);

    return performance;
  }

  async calculateProductivityScore(
    hollonId: string,
    period: 'week' | 'month',
  ): Promise<number>;
}
```

**2. PromptOptimizer**

```typescript
// apps/server/src/modules/performance/services/prompt-optimizer.service.ts

@Injectable()
export class PromptOptimizer {
  // Prompt íš¨ê³¼ ë¶„ì„
  async analyzePromptEffectiveness(hollon: Hollon, tasks: Task[]) {
    // 1. Taskë³„ í† í° ì‚¬ìš©ëŸ‰ vs í’ˆì§ˆ ë¶„ì„
    const analysis = await Promise.all(
      tasks.map(async (task) => ({
        taskId: task.id,
        tokenUsage:
          task.brainExecution?.cost?.inputTokens +
          task.brainExecution?.cost?.outputTokens,
        qualityScore: await this.calculateQualityScore(task),
        promptTemplate: task.metadata?.promptTemplateId,
      })),
    );

    // 2. A/B í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¹„êµ
    const variants = this.groupByPromptTemplate(analysis);

    // 3. í†µê³„ì  ìœ ì˜ì„± ê²€ì¦ (t-test)
    const significantDifferences = this.performStatisticalTest(variants);

    return significantDifferences;
  }

  // Prompt ìµœì í™” ì œì•ˆ
  async suggestOptimizations(hollon: Hollon): Promise<{
    currentTokenUsage: number;
    optimizedTokenUsage: number;
    savings: number;
    suggestedChanges: string[];
  }> {
    // Brain Providerì— ìµœì í™” ìš”ì²­
    const response = await this.brainProvider.executeWithTracking({
      systemPrompt: 'ë‹¹ì‹ ì€ Prompt ìµœì í™” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.',
      userPrompt: `ë‹¤ìŒ Hollonì˜ ì„±ê³¼ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³ , Prompt ìµœì í™” ë°©ì•ˆì„ ì œì•ˆí•˜ì„¸ìš”:

        í˜„ì¬ Prompt:
        ${hollon.role.systemPrompt}
        ${hollon.personality}

        ì„±ê³¼ ë°ì´í„°:
        - í‰ê·  í† í° ì‚¬ìš©ëŸ‰: ${await this.getAverageTokenUsage(hollon)}
        - í‰ê·  í’ˆì§ˆ ì ìˆ˜: ${await this.getAverageQuality(hollon)}
        - ì™„ë£Œ ì‹œê°„: ${await this.getAverageCompletionTime(hollon)}

        ëª©í‘œ: í† í° 15% ì ˆê°, í’ˆì§ˆ ìœ ì§€`,
    });

    return this.parseOptimizationSuggestions(response);
  }
}
```

**3. BestPracticeService**

```typescript
// apps/server/src/modules/performance/services/best-practice.service.ts

@Injectable()
export class BestPracticeService {
  // ê³ ì„±ê³¼ Task íŒ¨í„´ ì¶”ì¶œ
  async extractPatternsFromHighPerformance(team: Team) {
    // 1. ìƒìœ„ 20% ì„±ê³¼ Task ì„ ì •
    const highPerformanceTasks = await this.taskService.findTopPerformers(
      { teamId: team.id },
      { percentile: 20 },
    );

    // 2. ê³µí†µ íŒ¨í„´ ë¶„ì„ (Brain Provider)
    const patterns = await this.brainProvider.executeWithTracking({
      systemPrompt: 'ë‹¹ì‹ ì€ ì½”ë“œ íŒ¨í„´ ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.',
      userPrompt: `ë‹¤ìŒ ê³ ì„±ê³¼ Taskë“¤ì˜ ê³µí†µ íŒ¨í„´ì„ ì¶”ì¶œí•˜ì„¸ìš”:

        Tasks:
        ${highPerformanceTasks.map((t) => `- ${t.title}: ${t.description}`).join('\n')}

        ë¶„ì„ í•­ëª©:
        - ì½”ë“œ êµ¬ì¡° íŒ¨í„´
        - í…ŒìŠ¤íŠ¸ íŒ¨í„´
        - ì˜ì¡´ì„± ê´€ë¦¬
        - í˜‘ì—… ë°©ì‹`,
    });

    // 3. Best Practice Document ìƒì„±
    await this.documentService.create({
      title: `Best Practices - ${team.name}`,
      content: patterns.output,
      docType: 'guide',
      scope: 'team',
      scopeId: team.id,
      keywords: ['best-practice', 'patterns', 'high-performance'],
      importance: 9,
      autoGenerated: true,
    });

    return patterns;
  }
}
```

#### í…ŒìŠ¤íŠ¸

- `performance-analyzer.service.spec.ts`
- `prompt-optimizer.service.spec.ts`
- `best-practice.service.spec.ts`
- `phase4.3-self-improvement.e2e-spec.ts`

#### ì„±ê³µ ê¸°ì¤€

- [ ] ì„±ê³¼ ë©”íŠ¸ë¦­ ìë™ ìˆ˜ì§‘ (100%)
- [ ] Prompt ìµœì í™”ë¡œ í† í° 15% ì ˆê°
- [ ] Best Practice Document ìë™ ìƒì„±
- [ ] ë™ì¼ Task 5íšŒ ìˆ˜í–‰ ì‹œ íš¨ìœ¨ì„± 20% í–¥ìƒ

---

## ğŸ”„ Phase 3ì—ì„œ ì´ì›”ëœ ê¸°ëŠ¥

| ê¸°ëŠ¥                | SSOT ì°¸ì¡°  | ìš°ì„ ìˆœìœ„ | Phase 4 ë°°ì¹˜ |
| ------------------- | ---------- | -------- | ------------ |
| Channel (ê·¸ë£¹ ì±„íŒ…) | Â§ 3, Â§ 4.4 | ë†’ìŒ     | Week 3-4     |
| ìë™ Standup        | Â§ 8.2      | ì¤‘ê°„     | Week 3-4     |
| ìë™ Retrospective  | Â§ 8.2      | ì¤‘ê°„     | Week 3-4     |
| Vector RAG          | Â§ 5.6      | ë†’ìŒ     | Week 1-2     |
| Graph RAG           | Â§ 5.6      | ì¤‘ê°„     | Week 1-2     |

**Phase 5ë¡œ ë¯¸ë£¬ ê¸°ëŠ¥**:

- Contract ì‹œìŠ¤í…œ (íŒ€ ê°„ í˜‘ì—…) - Â§ 8.3
- ììœ¨ Goal ìƒì„± - Â§ 6.8
- GitHub/Slack Integration - blueprint Phase 5
- Web UI ì „ì²´ - blueprint Phase 5

---

## âœ… ì„±ê³µ ê¸°ì¤€

### Phase 4 ì™„ë£Œ ê¸°ì¤€

| ê¸°ì¤€                     | ì¸¡ì • ë°©ë²•           | ëª©í‘œ       |
| ------------------------ | ------------------- | ---------- |
| **Document ìë™ ìƒì„±**   | E2E í…ŒìŠ¤íŠ¸          | 100%       |
| **Vector search ì •í™•ë„** | ì •í™•ë„ ì¸¡ì •         | 85%+       |
| **Channel ë©”ì‹œì§€ ì „ì†¡**  | í†µí•© í…ŒìŠ¤íŠ¸         | 100%       |
| **ìë™ Standup ì‹¤í–‰**    | Cron í…ŒìŠ¤íŠ¸         | ë§¤ì¼ 09:00 |
| **ìë™ Retrospective**   | ì‚¬ì´í´ ì¢…ë£Œ ì‹œ      | 100%       |
| **íš¨ìœ¨ì„± í–¥ìƒ**          | PerformanceAnalyzer | 20%+       |
| **í† í° ì ˆê°**            | PromptOptimizer     | 15%+       |

### SSOT ë‹¬ì„±ë„ ê²€ì¦

```bash
# 1. Vector/Graph RAG ê²€ì¦
pnpm --filter @hollon-ai/server test:e2e phase4.1-knowledge-system

# 2. Channel í˜‘ì—… ê²€ì¦
pnpm --filter @hollon-ai/server test:e2e phase4.2-collaboration

# 3. ìë™ íšŒì˜ ê²€ì¦
pnpm --filter @hollon-ai/server test:integration standup

# 4. ìê¸° ê°œì„  ê²€ì¦
pnpm --filter @hollon-ai/server test:e2e phase4.3-self-improvement
```

---

## ğŸ¯ Blueprint ì—…ë°ì´íŠ¸ ì œì•ˆ

### ë³€ê²½ ì „ (blueprint.md)

```
### Phase 4: í•™ìŠµ ë° ì„±ì¥ - 4ì£¼

Week 1-2: ì§€ì‹ ì¶”ì¶œ ë° Vector RAG
Week 3-4: ìê¸° ê°œì„  ì‹œìŠ¤í…œ
```

### ë³€ê²½ í›„ (ì œì•ˆ)

```
### Phase 4: í•™ìŠµ ë° ì„±ì¥ - 6ì£¼

Week 1-2: ì§€ì‹ ì‹œìŠ¤í…œ (Knowledge Extraction + Vector/Graph RAG)
â”œâ”€â”€ KnowledgeExtractionService
â”œâ”€â”€ VectorSearchService
â””â”€â”€ KnowledgeGraphService

Week 3-4: í˜‘ì—… ì‹œìŠ¤í…œ (Channel + ìë™ íšŒì˜)
â”œâ”€â”€ Channel Entity & Service
â”œâ”€â”€ StandupService (ë§¤ì¼ 09:00)
â”œâ”€â”€ RetrospectiveService (ì‚¬ì´í´ ì¢…ë£Œ)
â””â”€â”€ MessageListener ê°œì„ 

Week 5-6: ë©”ëª¨ë¦¬ ë° ìê¸° ê°œì„ 
â”œâ”€â”€ PerformanceAnalyzer
â”œâ”€â”€ PromptOptimizer
â””â”€â”€ BestPracticeService
```

---

## ğŸ“ ë³€ê²½ ì´ë ¥

| ë‚ ì§œ       | ë²„ì „ | ë³€ê²½ ë‚´ìš©                                            |
| ---------- | ---- | ---------------------------------------------------- |
| 2025-12-12 | 1.0  | Phase 4 ìˆ˜ì • ê³„íš ì‘ì„± (4ì£¼ â†’ 6ì£¼, í˜‘ì—… ì‹œìŠ¤í…œ ì¶”ê°€) |
| 2025-12-12 | 1.1  | Phase 3 ë¯¸ë£¬ ê¸°ëŠ¥ í†µí•©, SSOT ë‹¬ì„±ë„ ëª…ì‹œ             |

---

**ë¬¸ì„œ ë²„ì „**: 1.1
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-12-12
**ì‘ì„±ì**: Claude Code
**ìƒíƒœ**: Phase 4 ìˆ˜ì • ê³„íš (ê²€í†  ì¤‘)
