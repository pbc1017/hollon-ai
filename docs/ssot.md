# Hollon-AI: Multi-Agent System SSOT (Single Source of Truth)

> 이 문서는 Hollon-AI 시스템의 **핵심 개념과 원칙**을 정의합니다.
> 구체적인 구현(DB 스키마, TypeScript 코드, 로드맵 등)은 [blueprint.md](./blueprint.md)를 참조하세요.

---

## 1. 비전 & 핵심 개념

### 1.1 비전

재귀적 멀티 에이전트 시스템. 회사 조직 구조처럼 동작하는 에이전트들이 계층적으로 협업하여 복잡한 작업을 수행한다.

### 1.2 핵심 개념

**Hollon(홀론)**: 전체이자 부분인 자율적 에이전트 단위
- Arthur Koestler의 홀라키(Holarchy) 개념에서 영감
- 각 홀론은 Brain Provider(Claude Code 등)를 통해 실행됨

**Organization(조직)**: 홀론들의 최상위 컨테이너, 리소스/비용 제한 관리

---

## 2. 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                      Web UI (Next.js)                       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    Backend Server (NestJS)                  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                   PostgreSQL (Data Layer)                   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                 Brain Providers (Holons)                    │
│    Claude Code, Gemini CLI, Claude API 등                   │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 핵심 엔티티

| 엔티티 | 설명 | 회사 비유 |
|--------|------|----------|
| **Organization** | 최상위 컨테이너, 비용/리소스 제한 | 회사 |
| **Role** | 역할 템플릿 (시스템 프롬프트, 권한, 자율성) | 직무 기술서 |
| **Team** | 홀론들의 그룹, 계층 구조 지원 | 부서/팀 |
| **Hollon** | Role 기반 에이전트 인스턴스 | 직원 |
| **Project** | 목표 달성을 위한 작업 묶음 | 프로젝트 |
| **Task** | 재귀적 작업 단위 (Sub-task 지원) | Linear 이슈 |
| **Milestone** | 프로젝트의 중요 이정표 | 마일스톤 |
| **Cycle** | 시간 기반 작업 단위, 예산 추적 | 스프린트 |
| **Channel** | 그룹 커뮤니케이션 공간 | Slack 채널 |
| **Document** | Markdown 문서 + Long-term Memory | Wiki/Notion |
| **Message** | 홀론 간 1:1 커뮤니케이션 | DM |

---

## 4. 핵심 원칙

### 4.1 Single Context 원칙

홀론은 **하나의 컨텍스트에서 하나의 태스크**를 완료하고, 다음 태스크를 가져옵니다.

```
홀론 실행 사이클:
1. Task Pull → 2. Context 시작 → 3. 작업 수행 → 4. 결과 저장 → 5. Context 종료 → (반복)
```

**이점:**
- 컨텍스트 유실 문제 해결 (매 태스크가 독립적)
- 명확한 작업 단위와 측정 가능한 성과
- 실패 시 영향 범위 최소화
- 병렬 처리 용이

### 4.2 6계층 프롬프트 합성

| 계층 | 소스 | 역할 |
|------|------|------|
| Layer 1 | Organization Context | 회사 비전, 핵심 가치, 전사 규칙 |
| Layer 2 | Team Context | 팀 목표, 협업 규칙 |
| Layer 3 | Role Prompt | 역할 정의, 전문 지식, 권한 |
| Layer 4 | Hollon Custom | 개별 홀론 성격, 특화 영역 |
| Layer 5 | Long-term Memory | 관련 Document (자동 선택) |
| Layer 6 | Task Context | 현재 태스크 정보 |

### 4.3 Brain Provider 아키텍처

홀론의 "두뇌"는 다양한 AI 백엔드를 지원하도록 추상화됩니다.

| Provider | 카테고리 | 코드실행 | 파일시스템 |
|----------|---------|---------|-----------|
| **claude-code** (기본) | CLI | ✅ | ✅ |
| gemini-cli | CLI | ✅ | ✅ |
| claude-api | API | ❌ | ❌ |
| gemini-api | API | ❌ | ❌ |

**선택 우선순위**: `Hollon 설정 > Role 설정 > Organization 기본값`

### 4.4 Document-Memory 통합

Document 시스템이 Long-term Memory 역할을 겸합니다.

| 속성 | 설명 |
|------|------|
| **scope** | organization / team / project / hollon |
| **doc_type** | spec, adr, guide, memory, postmortem |
| **keywords** | 검색/매칭용 키워드 배열 |
| **importance** | 1-10 중요도 (주입 우선순위) |
| **auto_generated** | 자동 생성 여부 |

---

## 5. 자율 운영 정책

### 5.1 운영 철학: "사람은 이사회"

인간은 전략적 결정과 예외 상황에만 개입합니다. 일상적인 운영은 홀론들이 자율적으로 수행합니다.

### 5.2 인간-홀론 역할 분담 (통합)

| 영역 | 🧑 인간 (승인 필요) | 🤖 홀론 (자율) |
|------|-------------------|---------------|
| **조직 관리** | 영구 홀론 생성/삭제 | 임시 홀론 생성/종료 |
| **전략** | 전략 방향 변경, Goal 설정 | 태스크 할당/처리, 서브태스크 생성 |
| **리소스** | 예산 초과 승인 | 예산 범위 내 작업 |
| **외부 영향** | 외부 이해관계자 영향, 법적/규정 | 내부 시스템만 영향 |
| **되돌림** | 되돌릴 수 없는 결정 | 되돌릴 수 있는 결정 |
| **피벗 대응** | 피벗 결정, Goal 폐기/수정 | 영향 분석, 작업 중단, 자산 분류 |
| **파일/API** | 허용 외 파일 접근, 미승인 외부 API | 허용된 경로/API 접근 |

### 5.3 에스컬레이션 계층

```
Level 1: 자기 해결 (재시도, 대안 탐색)
    ↓ 실패 시
Level 2: 팀 내 협업 (같은 팀 홀론에게 도움 요청)
    ↓ 해결 불가 시
Level 3: 팀 리더 판단 (우선순위 조정, 리소스 재배치)
    ↓ 권한 밖 시
Level 4: 상위 팀/조직 레벨
    ↓ 중대 사안 시
Level 5: 인간 개입 요청
```

### 5.4 품질 게이트

| 게이트 | 검증 내용 | 실패 시 |
|--------|----------|---------|
| 태스크 완료 검증 | 결과물 존재, 포맷 준수 | 재작업 요청 |
| 코드 품질 검증 | 린트, 테스트 통과 | 자동 수정 시도 |
| 비용 검증 | 예산 범위 내 | 작업 중단, 승인 요청 |
| 시간 검증 | SLA 내 완료 | 우선순위 상향 |
| 의존성 검증 | 블로커 태스크 완료 | 대기 또는 에스컬레이션 |

---

## 6. LLM 한계 대응 원칙

| LLM 한계 | 시스템 대응 |
|---------|------------|
| 컨텍스트 윈도우 제한 | Single Context 원칙 + 태스크 분할 |
| 상태 비저장 | Document-Memory 시스템 |
| 할루시네이션 | FactCheckService (구문→실행→참조→의미 검증) |
| 일관성 없는 출력 | DecisionLogService (결정 기록/참조) |
| 장기 계획 능력 부족 | GoalDecompositionService |
| 자기 인식 부재 | 5단계 Escalation |
| 실시간 정보 부재 | ExternalKnowledgeService (허용된 소스만) |

**수용해야 하는 한계:**
- 100% 할루시네이션 방지 불가 → 중요 결과물은 인간 검토 필수
- 창의적 판단 품질 불확실 → 전략적 결정은 승인 필요
- 예측 불가능한 에지 케이스 → 에스컬레이션 + 인간 개입

---

## 7. 협업 및 커뮤니케이션 원칙

### 7.1 정기 회의 자동화

| 회의 유형 | 트리거 | 결과물 |
|----------|-------|--------|
| 데일리 스탠드업 | 매일 지정 시간 | 진행상황 요약 Document |
| 스프린트 플래닝 | 사이클 시작 | 태스크 할당 계획 |
| 스프린트 회고 | 사이클 종료 | 회고 Document + 개선 액션 |

### 7.2 크로스팀 협업

팀 간 의존성은 **Contract(인터페이스 계약)**로 관리:
- 제공 범위, API 스펙
- 일정, 우선순위
- 변경 시 통보 의무

### 7.3 긴급 대응 (Incident Response)

| 등급 | 기준 | 대응 |
|------|------|------|
| **P1** | 전체 시스템 영향 | 즉시 인간 알림 + 모든 작업 중단 |
| **P2** | 주요 기능 영향 | 인간 알림 + 관련 작업 중단 |
| **P3** | 부분 영향 | 홀론 자체 해결 시도 |
| **P4** | 경미한 이슈 | 백로그에 추가 |

### 7.4 불확실성 의사결정 원칙

**자율 결정 가능 조건** (모두 충족 시):
1. 되돌릴 수 있는가? ✅
2. 비용 한도 내인가? ✅
3. 외부 영향 없는가? ✅

하나라도 No → 🧑 인간 에스컬레이션

**Time-boxed 실험 (Spike)**: 불확실성 해소를 위해 시간/비용 제한 내 실험 수행

---

## 8. 기술 스택

| 영역 | 기술 |
|------|------|
| **프론트엔드** | Next.js 14, React 18, TypeScript |
| **백엔드** | NestJS, TypeScript |
| **데이터베이스** | PostgreSQL 16 |
| **ORM** | TypeORM 또는 Prisma |
| **실시간** | WebSocket + PostgreSQL LISTEN/NOTIFY |
| **에이전트** | Claude Code (기본), Gemini CLI, API 등 |
| **빌드** | pnpm, Turborepo, Docker |

---

## 9. 용어 정리

| 용어 | 정의 |
|------|------|
| **Organization** | 최상위 컨테이너 (회사) |
| **Role** | 역할 템플릿 (직무 기술서) |
| **Team** | 홀론들의 그룹 (부서/팀) |
| **Hollon** | Role 기반 에이전트 인스턴스 (직원) |
| **Sub-Hollon** | 영구 홀론이 생성하는 임시 홀론 (임시 외주) |
| **Project** | 목표 달성을 위한 작업 묶음 |
| **Task** | 재귀적 작업 단위 (Linear 이슈) |
| **Cycle** | 시간 기반 작업 단위 (스프린트) |
| **Brain Provider** | 홀론의 AI 두뇌 추상화 |
| **Single Context** | 하나의 컨텍스트에서 하나의 태스크 완료 원칙 |
| **Prompt Hierarchy** | 6계층 프롬프트 합성 구조 |
| **Memory (Document)** | Document의 Long-term Memory 역할 |
| **Escalation** | 문제 발생 시 단계적 상위 보고 |
| **Quality Gate** | 자율 운영의 품질 검증 체크포인트 |
| **Goal** | OKR 구조의 목표 |
| **Decision Log** | 중요 결정 기록/참조 시스템 |
| **Fact Check** | 생성 결과물의 검증 |
| **Incident** | 긴급 대응이 필요한 이슈 (P1-P4) |
| **Contract** | 팀 간 인터페이스/의존성 계약 |
| **Pivot** | 전략 방향 변경 (인간 승인 필요) |
| **Spike** | 불확실성 해소를 위한 Time-boxed 실험 |

---

## 문서 참조

- **구현 명세**: [blueprint.md](./blueprint.md) - DB 스키마, TypeScript 코드, API 정의, 로드맵

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 |
|------|------|----------|
| 2024-12-03 | 0.1.0 | 초기 문서 작성 |
| 2024-12-04 | 1.0.0 | 자율 운영 모델 추가 |
| 2024-12-04 | 2.0.0 | 협업 시스템, LLM 한계 대응 추가 |
| 2024-12-04 | 2.3.0 | 피벗 대응, 불확실성 의사결정 추가 |
| 2024-12-04 | 3.0.0 | SSOT 압축: 핵심 원칙만 유지, 구현 상세는 blueprint.md로 이동 |
