# Plan: Backend Engineering: 시스템 프롬프트 코드 관리 시스템 구축

## Task Information
- **Task ID**: 88d26681-c235-42ac-a718-af3cdfe29e46
- **Type**: team_epic
- **Created**: 2026-01-08T16:04:00.102Z

## Objective

Build a comprehensive **System Prompt Code Management System** that migrates hard-coded system prompts from the seed.ts file to a modular, template-based code system. This system will enable version control, better maintainability, and flexible prompt management while keeping default prompts in code templates and allowing database overrides for customization.

## Analysis

### Current State

#### System Prompt Storage
Currently, system prompts are hard-coded in `apps/server/src/database/seed.ts`:
- **11 Role definitions** with embedded systemPrompt strings (CTO, TechLead, BackendEngineer, FrontendEngineer, QAEngineer, JuniorBackendEngineer, MLEngineer, DataEngineer, PlanningSpecialist, ImplementationSpecialist, TestingSpecialist, IntegrationSpecialist)
- **10 Hollon definitions** with custom systemPrompt strings that extend their role's base prompt
- Each systemPrompt is a multi-line string (ranging from 50-200 lines) containing:
  - Role responsibilities and mission
  - Technical guidelines and coding standards
  - Workflow instructions
  - Context-specific information
  - Variable placeholders (e.g., team names, capabilities)

#### Current Architecture
- **RoleService** (`apps/server/src/modules/role/role.service.ts`): Manages Role entities with systemPrompt stored in database
- **HollonService** (`apps/server/src/modules/hollon/hollon.service.ts`): Manages Hollon entities with optional systemPrompt overrides
- **Role Entity** (`apps/server/src/modules/role/entities/role.entity.ts`): Contains `systemPrompt` text field
- **Hollon Entity** (`apps/server/src/modules/hollon/entities/hollon.entity.ts`): Contains `systemPrompt` text field (nullable)

#### Issues with Current Approach
1. **No version control**: Prompt changes require database migrations or manual updates
2. **Hard to maintain**: 2000+ lines of prompt text scattered in seed file
3. **No reusability**: Common prompt patterns are duplicated across roles
4. **No type safety**: String concatenation without validation
5. **Testing difficulty**: Cannot unit test prompt generation logic
6. **Collaboration friction**: Multiple developers editing large seed file causes merge conflicts

### Proposed Architecture

#### Module Structure
```
apps/server/src/modules/prompt-templates/
├── interfaces/
│   ├── prompt-template.interface.ts      # Core interfaces (IPromptTemplate, IRoleTemplate, IPromptVariable)
│   └── role-type.enum.ts                 # Role enum/types
├── templates/
│   ├── roles/
│   │   ├── cto.template.ts              # CTO role template
│   │   ├── tech-lead.template.ts        # TechLead role template
│   │   ├── backend-engineer.template.ts # BackendEngineer template
│   │   ├── ai-lead.template.ts          # AILead/MLEngineer template
│   │   ├── infra-lead.template.ts       # InfraLead template
│   │   └── ...                          # Other role templates
│   └── index.ts                         # Template registry/exports
├── services/
│   ├── prompt-template-registry.service.ts  # Template registry & lookup
│   ├── prompt-merge.service.ts              # Merge code templates + DB overrides
│   ├── prompt-validation.service.ts         # Template validation
│   └── prompt-version.service.ts            # Version management
├── dtos/
│   ├── create-prompt-template.dto.ts
│   ├── update-prompt-template.dto.ts
│   └── prompt-template-response.dto.ts
├── controllers/
│   └── prompt-template.controller.ts    # API endpoints for template preview/management
├── prompt-template.module.ts            # Module definition
└── README.md                            # Documentation
```

#### Key Design Patterns

**1. Template-Based Architecture**
- Each role has a TypeScript template file that implements `IPromptTemplate`
- Templates contain:
  - `roleType`: Role identifier (enum)
  - `version`: Semantic versioning (e.g., "1.0.0")
  - `variables`: Required variable definitions
  - `generatePrompt(variables)`: Function that returns the final prompt string

**2. Merge Strategy**
- **Code templates** = Default prompts (version controlled)
- **Database values** = Custom overrides (per Role/Hollon)
- **Priority**: DB override > Code template > Empty string

```typescript
// Pseudocode
function getSystemPrompt(role: Role, hollon?: Hollon): string {
  const template = PromptTemplateRegistry.getByRole(role.name);
  const variables = extractVariables(role, hollon);
  const defaultPrompt = template.generatePrompt(variables);

  // DB override takes priority
  return hollon?.systemPrompt || role.systemPrompt || defaultPrompt;
}
```

**3. Variable Substitution**
Templates use typed variables for dynamic content:
```typescript
interface IPromptVariable {
  name: string;           // e.g., "teamName", "capabilities"
  type: 'string' | 'array' | 'object';
  required: boolean;
  defaultValue?: any;
}
```

### Codebase Impact

#### Files to Create (New Module)
1. **Interfaces & Types**
   - `interfaces/prompt-template.interface.ts` - Core interfaces
   - `interfaces/role-type.enum.ts` - Role type definitions

2. **Template Files** (11 files, one per role)
   - `templates/roles/cto.template.ts`
   - `templates/roles/tech-lead.template.ts`
   - `templates/roles/backend-engineer.template.ts`
   - `templates/roles/frontend-engineer.template.ts`
   - `templates/roles/qa-engineer.template.ts`
   - `templates/roles/junior-backend-engineer.template.ts`
   - `templates/roles/ml-engineer.template.ts`
   - `templates/roles/data-engineer.template.ts`
   - `templates/roles/planning-specialist.template.ts`
   - `templates/roles/implementation-specialist.template.ts`
   - `templates/roles/testing-specialist.template.ts`
   - `templates/roles/integration-specialist.template.ts`
   - `templates/index.ts` - Central registry

3. **Services**
   - `services/prompt-template-registry.service.ts` - Template management
   - `services/prompt-merge.service.ts` - Merge logic
   - `services/prompt-validation.service.ts` - Validation
   - `services/prompt-version.service.ts` - Version management

4. **DTOs**
   - `dtos/create-prompt-template.dto.ts`
   - `dtos/update-prompt-template.dto.ts`
   - `dtos/prompt-template-response.dto.ts`

5. **Controllers**
   - `controllers/prompt-template.controller.ts` - REST API

6. **Module Definition**
   - `prompt-template.module.ts`
   - `README.md`

7. **Tests** (Test files for each service/controller)
   - `services/*.spec.ts` (4 test files)
   - `controllers/*.spec.ts` (1 test file)
   - E2E test file

8. **Documentation**
   - `docs/prompt-template-system.md` - Comprehensive guide

#### Files to Modify

1. **Role Service Integration**
   - `apps/server/src/modules/role/role.service.ts`
     - Inject `PromptMergeService`
     - Modify methods that return system prompts
     - Use merged prompts instead of DB-only values

2. **Hollon Service Integration**
   - `apps/server/src/modules/hollon/hollon.service.ts`
     - Inject `PromptMergeService`
     - Modify Hollon creation to use template system
     - Update prompt retrieval logic

3. **Seed Data**
   - `apps/server/src/database/seed.ts`
     - Remove or null out `systemPrompt` fields
     - Keep Role/Hollon creation logic
     - Add comment directing to code templates

4. **App Module**
   - `apps/server/src/app.module.ts`
     - Import `PromptTemplateModule`

### Dependencies Affected

**New Dependencies**: None required (uses existing NestJS, TypeORM, class-validator)

**Existing Dependencies**:
- `@nestjs/common` - For module, service, controller decorators
- `class-validator` - For DTO validation
- `class-transformer` - For DTO transformation
- `typeorm` - For database operations (if needed for versioning)

### Technical Approach

#### Phase 1: Foundation (Items 1-3)
1. **Directory Structure Setup**
   - Create `apps/server/src/modules/prompt-templates/` hierarchy
   - Set up subdirectories: interfaces, templates, services, dtos, controllers
   - Create README with architecture overview

2. **Interface & Type Definitions**
   ```typescript
   // interfaces/prompt-template.interface.ts
   export interface IPromptVariable {
     name: string;
     type: 'string' | 'array' | 'object';
     required: boolean;
     defaultValue?: any;
   }

   export interface IPromptTemplate {
     roleType: RoleType;
     version: string;
     variables: IPromptVariable[];
     generatePrompt(variables: Record<string, any>): string;
   }

   export enum RoleType {
     CTO = 'CTO',
     TechLead = 'TechnicalLead',
     BackendEngineer = 'BackendEngineer',
     // ... all 11 roles
   }
   ```

3. **Seed Data Analysis**
   - Extract all 11 systemPrompt strings from seed.ts
   - Document patterns: common sections, variable placeholders, role-specific content
   - Create markdown analysis document with findings

#### Phase 2: Core Templates (Items 4-8)
4-8. **Role Template Implementation**
   - Implement templates for all roles (CTO, TechLead, AILead, InfraLead, Backend, Frontend, QA, Junior, Planning, Implementation, Testing, Integration)
   - Each template follows same structure:
     ```typescript
     export class CTOTemplate implements IPromptTemplate {
       roleType = RoleType.CTO;
       version = '1.0.0';
       variables = [
         { name: 'organizationName', type: 'string', required: true },
         { name: 'teamNames', type: 'array', required: false }
       ];

       generatePrompt(vars: Record<string, any>): string {
         return `당신은 CTO-${vars.organizationName}입니다...`;
       }
     }
     ```
   - Extract content from seed.ts systemPrompt strings
   - Maintain exact wording to ensure backwards compatibility

#### Phase 3: Service Layer (Items 9-12)
9. **PromptTemplateRegistry Service**
   ```typescript
   @Injectable()
   export class PromptTemplateRegistry {
     private templates = new Map<RoleType, IPromptTemplate>();

     constructor() {
       // Register all templates
       this.register(new CTOTemplate());
       this.register(new TechLeadTemplate());
       // ...
     }

     getTemplateByRole(roleType: RoleType): IPromptTemplate {
       return this.templates.get(roleType);
     }
   }
   ```

10. **PromptMergeService**
    ```typescript
    @Injectable()
    export class PromptMergeService {
      constructor(private registry: PromptTemplateRegistry) {}

      mergePrompts(role: Role, hollon?: Hollon): string {
        // 1. Get template
        const template = this.registry.getTemplateByRole(role.name);

        // 2. Extract variables from role/hollon
        const variables = this.extractVariables(role, hollon);

        // 3. Generate default prompt
        const defaultPrompt = template.generatePrompt(variables);

        // 4. Apply priority: hollon.systemPrompt > role.systemPrompt > default
        return hollon?.systemPrompt || role.systemPrompt || defaultPrompt;
      }
    }
    ```

11. **DTO Definitions**
    - CreatePromptTemplateDto with validation
    - UpdatePromptTemplateDto (PartialType)
    - PromptTemplateResponseDto

12. **Controller for Preview API**
    - GET `/prompt-templates/:role` - Get template by role
    - GET `/prompt-templates/preview` - Preview with variables
    - Swagger documentation

#### Phase 4: Integration (Items 13-16)
13. **Module Registration**
    - Create PromptTemplateModule with providers/controllers
    - Import in AppModule

14. **Role Service Integration**
    - Inject PromptMergeService into RoleService
    - Modify methods to use merged prompts
    - Remove hard-coded prompt logic

15. **Hollon Service Integration**
    - Inject PromptMergeService into HollonService
    - Update createPermanent/createTemporary methods
    - Ensure prompt retrieval uses new system

16. **Seed Data Migration**
    - Remove systemPrompt assignments or set to null
    - Add comments explaining template system
    - Verify seed still creates roles/hollons correctly

#### Phase 5: Advanced Features (Items 17-19)
17. **Version Management** (Optional - P3)
    - PromptVersionService for history tracking
    - Version comparison and rollback
    - May require additional database table

18. **Preview Functionality** (Optional - P3)
    - Enhanced preview endpoint with variable substitution
    - Validate variables before rendering

19. **Validation Logic** (Optional - P3)
    - PromptValidationService
    - Check for missing required variables
    - Validate variable types

#### Phase 6: Testing (Items 20-22)
20. **Service Unit Tests**
    - Test PromptTemplateRegistry template lookup
    - Test PromptMergeService merge logic with DB priority
    - Test variable substitution accuracy
    - Test all edge cases (null values, missing variables)

21. **Controller Unit Tests**
    - Test all endpoints (GET /prompt-templates/:role, /preview)
    - Test DTO validation
    - Test error responses

22. **Integration Tests**
    - E2E test: Create Role → Get merged prompt
    - E2E test: Create Hollon → Verify prompt inheritance
    - E2E test: Override prompt in DB → Verify priority

#### Phase 7: Documentation & Optimization (Items 23-25)
23. **Documentation**
    - Create `docs/prompt-template-system.md`
    - Architecture diagrams
    - API endpoint documentation
    - How to add new roles
    - Variable usage examples

24. **Performance Optimization** (Optional - P4)
    - Implement caching (in-memory or Redis)
    - Cache key: `role:${roleId}:hollon:${hollonId}`
    - Cache invalidation on updates

25. **Audit Logging** (Optional - P4)
    - Log prompt changes to audit table
    - Track who/when/what changed

#### Phase 8: Deployment (Item 26)
26. **Production Deployment**
    - Deploy new code with templates
    - Run seed to verify prompts work
    - Monitor logs for errors
    - Set up alerts for prompt-related issues
    - Prepare rollback plan

### Risks and Mitigations

| Risk | Impact | Mitigation |
|------|--------|------------|
| **Breaking changes to existing prompts** | High - Could affect Hollon behavior | 1. Exact string matching when extracting from seed.ts<br>2. Thorough testing before deployment<br>3. Feature flag to switch between old/new system |
| **Performance degradation from prompt merging** | Medium - Extra compute per prompt fetch | 1. Implement caching early (Phase 7)<br>2. Benchmark before/after<br>3. Use in-memory cache for templates |
| **Complex variable substitution bugs** | Medium - Wrong prompts sent to Hollons | 1. Comprehensive unit tests for all templates<br>2. Validation service to catch missing variables<br>3. Preview endpoint for testing |
| **Database migration issues** | Low - Schema already supports null prompts | 1. No schema changes needed<br>2. Existing systemPrompt field can remain (for overrides)<br>3. Gradual migration (keep seed working) |
| **Team coordination on prompt changes** | Medium - Multiple developers editing templates | 1. Clear ownership (one template = one file)<br>2. Git history for version control<br>3. Code review process |
| **Backwards compatibility** | High - Must work with existing DB data | 1. DB overrides still take priority<br>2. Old prompts in DB continue working<br>3. No forced migration required |

### Success Metrics

- **Code Maintainability**: Prompt code reduced from 2000+ lines in seed.ts to modular templates
- **Version Control**: All prompt changes tracked in Git with clear diffs
- **Test Coverage**: 80%+ coverage for prompt template services
- **Performance**: Prompt retrieval time < 10ms (with caching)
- **Zero Behavioral Changes**: All existing Hollons continue working with identical prompts

## Decomposition

This team epic contains 26 implementation tasks that will be distributed to Backend Engineering team members. The tasks are organized into 8 phases for logical progression.

### Phase 1: Foundation Setup (P1 Priority)

#### Task 1: 프롬프트 템플릿 모듈 디렉토리 구조 설계 및 생성
- **Priority**: P1
- **Assignee Recommendation**: BackendEngineer (Developer-Bravo or Developer-Charlie)
- **Description**: Create the `apps/server/src/modules/prompt-templates/` directory structure with all subdirectories (templates/roles/, services/, dtos/, interfaces/, controllers/). Create initial README.md documenting the module architecture.
- **Acceptance Criteria**:
  - Directory structure exists with all required subdirectories
  - README.md contains architecture overview and usage guide
  - Commit: `feat: Add prompt-templates module structure`
- **Estimated Effort**: 1 hour
- **Dependencies**: None

#### Task 2: 프롬프트 템플릿 인터페이스 및 타입 정의
- **Priority**: P1
- **Assignee Recommendation**: BackendEngineer (Developer-Bravo)
- **Description**: Define core interfaces (`IPromptTemplate`, `IRoleTemplate`, `IPromptVariable`) and the `RoleType` enum in `interfaces/` directory. Include TypeScript types for variable substitution and version management.
- **Acceptance Criteria**:
  - `interfaces/prompt-template.interface.ts` exists with all interfaces
  - `interfaces/role-type.enum.ts` contains all 11+ role types
  - Types are exported and documented with JSDoc comments
  - Commit: `feat: Add prompt template interfaces and types`
- **Estimated Effort**: 2 hours
- **Dependencies**: Task 1

#### Task 3: 현재 시드 데이터에서 시스템 프롬프트 추출 및 분석
- **Priority**: P1
- **Assignee Recommendation**: JuniorBackendEngineer (Developer-Delta) or BackendEngineer
- **Description**: Extract all 11 systemPrompt strings from `seed.ts`. Analyze patterns (common sections, variables, role-specific content). Create analysis document in `docs/prompt-analysis.md`.
- **Acceptance Criteria**:
  - All prompts extracted and categorized by role
  - Pattern analysis completed (common templates, variables identified)
  - `docs/prompt-analysis.md` created with findings
  - Commit: `docs: Add system prompt analysis from seed data`
- **Estimated Effort**: 3 hours
- **Dependencies**: None

### Phase 2: Core Role Templates (P2 Priority)

#### Task 4: CTO Role 기본 프롬프트 템플릿 구현
- **Priority**: P2
- **Assignee Recommendation**: BackendEngineer (Developer-Bravo)
- **Description**: Implement `templates/roles/cto.template.ts` with CTOTemplate class. Extract CTO prompt from seed.ts and convert to template with variable substitution.
- **Acceptance Criteria**:
  - File exists and implements IPromptTemplate
  - generatePrompt() method returns exact content from seed.ts (validated)
  - Variables identified and typed
  - Commit: `feat: Add CTO role prompt template`
- **Estimated Effort**: 2 hours
- **Dependencies**: Tasks 2, 3

#### Task 5: TechLead Role 기본 프롬프트 템플릿 구현
- **Priority**: P2
- **Assignee Recommendation**: BackendEngineer (Developer-Charlie)
- **Description**: Implement `templates/roles/tech-lead.template.ts` following same pattern as CTO template.
- **Acceptance Criteria**:
  - File exists and implements IPromptTemplate
  - Content matches seed.ts TechLead prompt
  - Commit: `feat: Add TechLead role prompt template`
- **Estimated Effort**: 2 hours
- **Dependencies**: Tasks 2, 3, 4

#### Task 6: AILead Role 기본 프롬프트 템플릿 구현
- **Priority**: P2
- **Assignee Recommendation**: BackendEngineer (Developer-Charlie)
- **Description**: Implement `templates/roles/ai-lead.template.ts` (for MLEngineer role).
- **Acceptance Criteria**:
  - File exists with AI/ML specific content
  - Content matches seed.ts MLEngineer prompt
  - Commit: `feat: Add AILead role prompt template`
- **Estimated Effort**: 2 hours
- **Dependencies**: Tasks 2, 3, 4

#### Task 7: InfraLead Role 기본 프롬프트 템플릿 구현
- **Priority**: P2
- **Assignee Recommendation**: BackendEngineer (Developer-Bravo)
- **Description**: Implement `templates/roles/infra-lead.template.ts` with infrastructure/DevOps focus.
- **Acceptance Criteria**:
  - File exists with infra-specific content
  - Content matches seed.ts (if exists) or create appropriate template
  - Commit: `feat: Add InfraLead role prompt template`
- **Estimated Effort**: 2 hours
- **Dependencies**: Tasks 2, 3, 4

#### Task 8: 기타 Role 프롬프트 템플릿 구현
- **Priority**: P3
- **Assignee Recommendation**: JuniorBackendEngineer (Developer-Delta) or BackendEngineer
- **Description**: Implement remaining role templates: BackendEngineer, FrontendEngineer, QAEngineer, JuniorBackendEngineer, DataEngineer, PlanningSpecialist, ImplementationSpecialist, TestingSpecialist, IntegrationSpecialist.
- **Acceptance Criteria**:
  - All role template files exist (8 files)
  - Each implements IPromptTemplate correctly
  - Content matches seed.ts prompts exactly
  - Commit per template: `feat: Add [RoleName] role prompt template`
- **Estimated Effort**: 8 hours (1 hour per template)
- **Dependencies**: Tasks 2, 3, 4

### Phase 3: Service Layer (P1 Priority)

#### Task 9: 프롬프트 템플릿 레지스트리 서비스 구현
- **Priority**: P1
- **Assignee Recommendation**: BackendEngineer (Developer-Bravo)
- **Description**: Implement `PromptTemplateRegistry` service that registers and provides lookup for all role templates. Include caching and version management.
- **Acceptance Criteria**:
  - `services/prompt-template-registry.service.ts` exists
  - @Injectable() decorator applied
  - register() and getTemplateByRole() methods work
  - All templates auto-registered in constructor
  - Commit: `feat: Add prompt template registry service`
- **Estimated Effort**: 3 hours
- **Dependencies**: Tasks 4-8

#### Task 10: 프롬프트 병합 서비스 구현
- **Priority**: P1
- **Assignee Recommendation**: BackendEngineer (Developer-Charlie)
- **Description**: Implement `PromptMergeService` that merges code templates with DB overrides. Priority: DB hollon.systemPrompt > DB role.systemPrompt > code template.
- **Acceptance Criteria**:
  - `services/prompt-merge.service.ts` exists
  - mergePrompts(role, hollon?) method implemented
  - Variable extraction and substitution works
  - Priority rules correctly applied
  - Commit: `feat: Add prompt merge service`
- **Estimated Effort**: 4 hours
- **Dependencies**: Task 9

#### Task 11: 프롬프트 템플릿 DTO 정의
- **Priority**: P2
- **Assignee Recommendation**: JuniorBackendEngineer (Developer-Delta)
- **Description**: Create DTOs: CreatePromptTemplateDto, UpdatePromptTemplateDto, PromptTemplateResponseDto with class-validator decorators.
- **Acceptance Criteria**:
  - All 3 DTO files exist in `dtos/` directory
  - class-validator decorators applied (@IsString, @IsEnum, @IsOptional)
  - Proper typing and exports
  - Commit: `feat: Add prompt template DTOs`
- **Estimated Effort**: 2 hours
- **Dependencies**: Task 2

#### Task 12: 프롬프트 템플릿 컨트롤러 구현
- **Priority**: P2
- **Assignee Recommendation**: BackendEngineer (Developer-Bravo)
- **Description**: Create REST controller with endpoints: GET /prompt-templates/:role, GET /prompt-templates/preview. Integrate with services.
- **Acceptance Criteria**:
  - `controllers/prompt-template.controller.ts` exists
  - @Controller('prompt-templates') decorator
  - Both GET endpoints implemented and working
  - DTO validation active
  - Commit: `feat: Add prompt template controller`
- **Estimated Effort**: 3 hours
- **Dependencies**: Tasks 9, 10, 11

### Phase 4: Module Integration (P1 Priority)

#### Task 13: 프롬프트 템플릿 모듈 통합 및 등록
- **Priority**: P1
- **Assignee Recommendation**: BackendEngineer (Developer-Bravo or Developer-Charlie)
- **Description**: Create `PromptTemplateModule` with all providers and controllers. Import into `AppModule`. Ensure module exports services for use by other modules.
- **Acceptance Criteria**:
  - `prompt-template.module.ts` exists with @Module decorator
  - All services and controllers registered
  - Module imported in `app.module.ts`
  - Services exported for external use
  - Application starts without errors
  - Commit: `feat: Add prompt template module and integrate with AppModule`
- **Estimated Effort**: 2 hours
- **Dependencies**: Tasks 9, 10, 12

#### Task 14: Role 서비스에서 프롬프트 템플릿 서비스 통합
- **Priority**: P1
- **Assignee Recommendation**: BackendEngineer (Developer-Charlie)
- **Description**: Modify `RoleService` to inject `PromptMergeService`. Update methods that retrieve systemPrompt to use the new merge service instead of raw DB values.
- **Acceptance Criteria**:
  - RoleService constructor injects PromptMergeService
  - Methods use merged prompts (e.g., in findOne, create responses)
  - Hard-coded prompt logic removed
  - Existing functionality preserved (backwards compatible)
  - Commit: `refactor: Integrate prompt template service into RoleService`
- **Estimated Effort**: 3 hours
- **Dependencies**: Task 13

#### Task 15: Hollon 서비스에서 프롬프트 템플릿 서비스 통합
- **Priority**: P1
- **Assignee Recommendation**: BackendEngineer (Developer-Bravo)
- **Description**: Modify `HollonService` to inject `PromptMergeService`. Update createPermanent, createTemporary, and spawnTemporaryHollonForRole methods to use merged prompts.
- **Acceptance Criteria**:
  - HollonService constructor injects PromptMergeService
  - Hollon creation methods use merged prompts
  - Priority rules respected (hollon.systemPrompt overrides default)
  - Existing functionality preserved
  - Commit: `refactor: Integrate prompt template service into HollonService`
- **Estimated Effort**: 3 hours
- **Dependencies**: Task 13

#### Task 16: 시드 데이터에서 systemPrompt 필드 제거
- **Priority**: P2
- **Assignee Recommendation**: JuniorBackendEngineer (Developer-Delta)
- **Description**: Modify `seed.ts` to remove or set to null all systemPrompt fields in Role and Hollon creation. Add comments explaining the template system. Verify seed runs successfully.
- **Acceptance Criteria**:
  - All systemPrompt fields in seed.ts removed or set to null
  - Comments added explaining template system
  - `pnpm seed` command runs without errors
  - Created Roles/Hollons receive prompts from templates
  - Commit: `refactor: Remove hard-coded system prompts from seed data`
- **Estimated Effort**: 2 hours
- **Dependencies**: Tasks 14, 15

### Phase 5: Advanced Features (P3 Priority - Optional)

#### Task 17: 프롬프트 버전 관리 시스템 구현
- **Priority**: P3
- **Assignee Recommendation**: BackendEngineer (Developer-Charlie)
- **Description**: Implement version tracking system with PromptVersionService. Track template versions, changes, and enable rollback functionality.
- **Acceptance Criteria**:
  - `services/prompt-version.service.ts` exists
  - Version history recorded (may require DB table)
  - Rollback functionality implemented
  - Version comparison available
  - Commit: `feat: Add prompt version management system`
- **Estimated Effort**: 5 hours
- **Dependencies**: Task 10

#### Task 18: 프롬프트 템플릿 미리보기 기능 구현
- **Priority**: P3
- **Assignee Recommendation**: JuniorBackendEngineer (Developer-Delta)
- **Description**: Enhance preview endpoint to accept variables and render final prompt. Show variable substitution results.
- **Acceptance Criteria**:
  - GET /prompt-templates/preview endpoint enhanced
  - Accepts role and variables as query params
  - Returns fully rendered prompt with variables substituted
  - Validation for required variables
  - Commit: `feat: Add prompt template preview functionality`
- **Estimated Effort**: 2 hours
- **Dependencies**: Task 12

#### Task 19: 프롬프트 템플릿 유효성 검증 로직 구현
- **Priority**: P3
- **Assignee Recommendation**: BackendEngineer (Developer-Bravo)
- **Description**: Implement PromptValidationService to validate template structure, required variables, and detect errors (missing variables, invalid references).
- **Acceptance Criteria**:
  - `services/prompt-validation.service.ts` exists
  - Validates required variables present
  - Detects invalid variable references
  - Clear error messages
  - Commit: `feat: Add prompt template validation service`
- **Estimated Effort**: 3 hours
- **Dependencies**: Task 10

### Phase 6: Testing (P2 Priority)

#### Task 20: 단위 테스트 - 프롬프트 템플릿 서비스
- **Priority**: P2
- **Assignee Recommendation**: BackendEngineer or JuniorBackendEngineer (Developer-Delta)
- **Description**: Write unit tests for PromptTemplateRegistry and PromptMergeService. Test template lookup, merge logic, variable substitution, priority rules.
- **Acceptance Criteria**:
  - `*.spec.ts` files exist for both services
  - Test coverage ≥ 80%
  - All core logic tested (lookup, merge, substitution)
  - Edge cases covered (null values, missing variables, DB overrides)
  - All tests pass
  - Commit: `test: Add unit tests for prompt template services`
- **Estimated Effort**: 4 hours
- **Dependencies**: Tasks 9, 10

#### Task 21: 단위 테스트 - 프롬프트 템플릿 컨트롤러
- **Priority**: P2
- **Assignee Recommendation**: JuniorBackendEngineer (Developer-Delta)
- **Description**: Write unit tests for PromptTemplateController. Test all endpoints, DTO validation, error handling, response formats.
- **Acceptance Criteria**:
  - `prompt-template.controller.spec.ts` exists
  - All endpoints tested
  - DTO validation logic verified
  - Error responses tested
  - All tests pass
  - Commit: `test: Add unit tests for prompt template controller`
- **Estimated Effort**: 3 hours
- **Dependencies**: Task 12

#### Task 22: 통합 테스트 - Role과 Hollon 프롬프트 통합
- **Priority**: P2
- **Assignee Recommendation**: BackendEngineer (Developer-Charlie)
- **Description**: Write E2E tests for full integration: Create Role → Get prompt (uses template), Create Hollon → Get prompt (uses template + override). Test entire flow.
- **Acceptance Criteria**:
  - E2E test file exists (e.g., `prompt-template.e2e-spec.ts`)
  - Tests cover Role creation and prompt retrieval
  - Tests cover Hollon creation with prompt inheritance
  - Tests verify DB override priority
  - All tests pass
  - Commit: `test: Add E2E tests for prompt template integration`
- **Estimated Effort**: 4 hours
- **Dependencies**: Tasks 14, 15

### Phase 7: Documentation & Optimization (P3/P4 Priority - Optional)

#### Task 23: 프롬프트 템플릿 관리 문서 작성
- **Priority**: P3
- **Assignee Recommendation**: JuniorBackendEngineer (Developer-Delta) or BackendEngineer
- **Description**: Create comprehensive documentation in `docs/prompt-template-system.md`. Include architecture, API docs, usage examples, how to add new roles, variable guide.
- **Acceptance Criteria**:
  - `docs/prompt-template-system.md` exists
  - Architecture diagram included (Mermaid or image)
  - All API endpoints documented with examples
  - Guide for adding new roles
  - Variable usage examples
  - Commit: `docs: Add prompt template system documentation`
- **Estimated Effort**: 4 hours
- **Dependencies**: Tasks 13, 14, 15

#### Task 24: 성능 최적화 - 프롬프트 캐싱
- **Priority**: P4
- **Assignee Recommendation**: BackendEngineer (Developer-Charlie)
- **Description**: Implement caching strategy for prompt templates (in-memory cache or Redis). Cache merged prompts with invalidation on updates.
- **Acceptance Criteria**:
  - Caching implemented (in-memory or Redis)
  - Cache key strategy defined (role:${roleId}:hollon:${hollonId})
  - Cache invalidation on prompt updates
  - Performance improvement measured
  - Cache hit rate monitored
  - Commit: `perf: Add caching for prompt templates`
- **Estimated Effort**: 4 hours
- **Dependencies**: Task 10

#### Task 25: 프롬프트 템플릿 변경 로깅 및 감사
- **Priority**: P4
- **Assignee Recommendation**: BackendEngineer (Developer-Bravo)
- **Description**: Implement audit logging for prompt changes. Track who, when, and what changed. Store audit trail in database.
- **Acceptance Criteria**:
  - Audit log table/entity created (if needed)
  - Changes logged with user info and timestamps
  - Before/after content stored
  - Audit log query API implemented
  - Commit: `feat: Add audit logging for prompt template changes`
- **Estimated Effort**: 5 hours
- **Dependencies**: Task 10

### Phase 8: Deployment (P1 Priority)

#### Task 26: 프로덕션 배포 및 모니터링 설정
- **Priority**: P1
- **Assignee Recommendation**: TechnicalLead (TechLead-Alpha) + DevOps-India (if available)
- **Description**: Deploy new system to production. Set up monitoring, alerts, and logging. Perform post-deployment verification. Prepare rollback plan.
- **Acceptance Criteria**:
  - Code deployed to production
  - Post-deployment verification completed (sample Roles/Hollons created)
  - Log monitoring configured (prompt-related logs)
  - Error alerts set up
  - Rollback plan documented and ready
  - No regression in existing functionality
  - Commit: N/A (deployment activity)
- **Estimated Effort**: 3 hours
- **Dependencies**: All previous tasks completed

### Task Dependencies

**Critical Path**:
1. Tasks 1 → 2 → 3 (Foundation)
2. Tasks 4-8 (Templates - can be parallelized after Task 2)
3. Task 9 → 10 (Services)
4. Task 13 → 14, 15 → 16 (Integration)
5. Tasks 20, 21, 22 (Testing - parallel after integration)
6. Task 26 (Deployment)

**Parallel Work Opportunities**:
- Tasks 4-8 can be done in parallel by multiple developers
- Tasks 14 and 15 can be done in parallel
- Tasks 20, 21, 22 can be done in parallel
- Tasks 17, 18, 19 (optional features) can be done in parallel
- Tasks 23, 24, 25 (docs/optimization) can be done in parallel

### Recommended Team Allocation

**TechLead-Alpha** (Manager):
- Task distribution and coordination
- Code review for all tasks
- Final deployment (Task 26)

**Developer-Bravo** (Senior Backend):
- Tasks 1, 2, 4, 7, 9, 12, 13, 15, 19, 25

**Developer-Charlie** (Senior Backend):
- Tasks 5, 6, 10, 14, 17, 22, 24

**Developer-Delta** (Junior Backend):
- Tasks 3, 8, 11, 16, 18, 20, 21, 23

## Success Criteria

### Functional Requirements
- [ ] All 11 role prompt templates implemented and match seed.ts content exactly
- [ ] PromptMergeService correctly applies priority: DB override > code template
- [ ] Role and Hollon services successfully integrated with new system
- [ ] Seed data runs without systemPrompt fields (uses templates by default)
- [ ] API endpoints for template preview and management working
- [ ] All existing Hollons continue functioning with identical prompts

### Quality Requirements
- [ ] Unit test coverage ≥ 80% for all services and controllers
- [ ] E2E tests pass for full integration (Role + Hollon prompt flow)
- [ ] No breaking changes to existing API contracts
- [ ] Performance: Prompt retrieval time < 10ms (with caching)
- [ ] All lint and build checks pass

### Documentation Requirements
- [ ] Module README.md completed with architecture and usage
- [ ] Comprehensive system documentation in docs/prompt-template-system.md
- [ ] API endpoints documented with examples
- [ ] Guide for adding new roles published

### Operational Requirements
- [ ] Monitoring and alerts configured for production
- [ ] Rollback plan documented and tested
- [ ] Zero downtime deployment completed
- [ ] Post-deployment verification passed

---
*Generated by: PlanningSpecialist*
*Date: 2026-01-08T16:04:00.102Z*
*Status: PENDING_REVIEW*
