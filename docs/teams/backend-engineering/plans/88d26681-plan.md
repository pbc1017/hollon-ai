# Plan: Backend Engineering: 시스템 프롬프트 코드 관리 시스템 구축

## Task Information

- **Task ID**: 88d26681-c235-42ac-a718-af3cdfe29e46
- **Type**: team_epic
- **Created**: 2026-01-08T16:52:00.098Z

## Objective

현재 Hollon-AI 시스템에서 systemPrompt는 데이터베이스 시드 파일(seed.ts)에 하드코딩되어 있어 관리와 유지보수가 어려운 상태입니다. 이 프로젝트의 목표는:

1. **코드 기반 프롬프트 템플릿 시스템 구축**: 각 Role의 시스템 프롬프트를 TypeScript 코드로 관리하여 버전 관리, 재사용성, 타입 안전성을 확보
2. **유연한 병합 시스템 구현**: 코드 템플릿(기본값)과 DB 저장 값(커스터마이징)을 병합하여 최종 프롬프트 생성
3. **변수 치환 및 템플릿 기능**: 동적 변수 치환을 지원하여 프롬프트를 상황별로 커스터마이징
4. **중앙 집중식 관리**: PromptTemplateRegistry를 통한 중앙 관리로 일관성 확보
5. **기존 시스템과의 무중단 통합**: Role 및 Hollon 서비스와 통합하여 기존 기능 유지

## Analysis

### Codebase Impact

#### Files to Create

1. **Module Structure**
   - `apps/server/src/modules/prompt-templates/prompt-template.module.ts` - 모듈 정의
   - `apps/server/src/modules/prompt-templates/README.md` - 모듈 문서

2. **Interfaces and Types**
   - `apps/server/src/modules/prompt-templates/interfaces/prompt-template.interface.ts` - 핵심 인터페이스 정의
   - `apps/server/src/modules/prompt-templates/interfaces/index.ts` - 배럴 export

3. **Services**
   - `apps/server/src/modules/prompt-templates/services/prompt-template-registry.service.ts` - 템플릿 레지스트리
   - `apps/server/src/modules/prompt-templates/services/prompt-merge.service.ts` - 프롬프트 병합 로직
   - `apps/server/src/modules/prompt-templates/services/prompt-validation.service.ts` - 프롬프트 검증
   - `apps/server/src/modules/prompt-templates/services/prompt-version.service.ts` - 버전 관리

4. **Template Files (각 Role별)**
   - `apps/server/src/modules/prompt-templates/templates/roles/cto.template.ts`
   - `apps/server/src/modules/prompt-templates/templates/roles/tech-lead.template.ts`
   - `apps/server/src/modules/prompt-templates/templates/roles/ai-lead.template.ts`
   - `apps/server/src/modules/prompt-templates/templates/roles/infra-lead.template.ts`
   - `apps/server/src/modules/prompt-templates/templates/roles/backend-engineer.template.ts`
   - `apps/server/src/modules/prompt-templates/templates/roles/frontend-engineer.template.ts`
   - `apps/server/src/modules/prompt-templates/templates/roles/qa-engineer.template.ts`
   - `apps/server/src/modules/prompt-templates/templates/roles/ml-engineer.template.ts`
   - `apps/server/src/modules/prompt-templates/templates/roles/data-engineer.template.ts`
   - `apps/server/src/modules/prompt-templates/templates/roles/junior-backend-engineer.template.ts`
   - `apps/server/src/modules/prompt-templates/templates/roles/planning-specialist.template.ts`
   - `apps/server/src/modules/prompt-templates/templates/roles/implementation-specialist.template.ts`
   - `apps/server/src/modules/prompt-templates/templates/roles/testing-specialist.template.ts`
   - `apps/server/src/modules/prompt-templates/templates/roles/integration-specialist.template.ts`
   - `apps/server/src/modules/prompt-templates/templates/roles/index.ts` - 배럴 export

5. **DTOs**
   - `apps/server/src/modules/prompt-templates/dtos/create-prompt-template.dto.ts`
   - `apps/server/src/modules/prompt-templates/dtos/update-prompt-template.dto.ts`
   - `apps/server/src/modules/prompt-templates/dtos/prompt-template-response.dto.ts`
   - `apps/server/src/modules/prompt-templates/dtos/prompt-preview.dto.ts`

6. **Controllers**
   - `apps/server/src/modules/prompt-templates/controllers/prompt-template.controller.ts` - API 엔드포인트

7. **Tests**
   - `apps/server/src/modules/prompt-templates/services/*.spec.ts` - 서비스 단위 테스트
   - `apps/server/src/modules/prompt-templates/controllers/*.spec.ts` - 컨트롤러 테스트
   - `apps/server/test/prompt-templates.e2e-spec.ts` - E2E 테스트

8. **Documentation**
   - `docs/prompt-template-system.md` - 시스템 설명서
   - `docs/prompt-template-system-architecture.md` - 아키텍처 다이어그램

#### Files to Modify

1. **Module Registration**
   - `apps/server/src/app.module.ts` - PromptTemplateModule 추가

2. **Services Integration**
   - `apps/server/src/modules/role/role.service.ts` - PromptMergeService 통합
   - `apps/server/src/modules/hollon/hollon.service.ts` - PromptMergeService 통합

3. **Seed Data**
   - `apps/server/src/database/seed.ts` - systemPrompt 필드 제거 또는 null 처리

4. **Entity (Optional - DB 스키마 변경 없음)**
   - `apps/server/src/modules/role/entities/role.entity.ts` - 주석 업데이트
   - `apps/server/src/modules/hollon/entities/hollon.entity.ts` - 주석 업데이트

### Dependencies Affected

**New Dependencies (없음)**

- 기존 NestJS, TypeORM, class-validator를 사용
- 추가 외부 라이브러리 불필요

**Existing Dependencies Used**

- `@nestjs/common` - Injectable, Module, Controller
- `@nestjs/typeorm` - TypeORM 통합
- `typeorm` - Repository 패턴
- `class-validator` - DTO 검증
- `class-transformer` - DTO 변환

### Technical Approach

#### 1. Architecture Overview

```
┌─────────────────────────────────────────────────────────────┐
│                    PromptTemplateModule                      │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌─────────────────────┐      ┌──────────────────────────┐  │
│  │PromptTemplateRegistry│      │   Role Template Files    │  │
│  │     (Service)        │◄─────│   (Code Templates)       │  │
│  └──────────┬───────────┘      └──────────────────────────┘  │
│             │                                                 │
│             │ getTemplateByRole()                            │
│             ▼                                                 │
│  ┌─────────────────────┐      ┌──────────────────────────┐  │
│  │ PromptMergeService  │◄─────│   Role/Hollon Entity     │  │
│  │    (Merge Logic)    │      │   (DB Custom Prompts)    │  │
│  └─────────┬───────────┘      └──────────────────────────┘  │
│            │                                                  │
│            │ mergePrompts()                                  │
│            ▼                                                  │
│  ┌─────────────────────┐                                     │
│  │ Final System Prompt │                                     │
│  │  (Code + DB merged) │                                     │
│  └─────────────────────┘                                     │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

#### 2. Key Design Decisions

**A. 코드 우선 + DB 오버라이드 패턴**

- 기본 템플릿은 코드에 저장 (버전 관리, 타입 안전성)
- DB에는 커스터마이징만 저장 (null이면 코드 템플릿 사용)
- 병합 우선순위: DB 값 > 코드 템플릿

**B. 템플릿 인터페이스 구조**

```typescript
interface IPromptTemplate {
  roleId: string;
  roleName: string;
  version: string;
  template: string;
  variables: IPromptVariable[];
  metadata?: {
    description?: string;
    author?: string;
    lastUpdated?: Date;
  };
}

interface IPromptVariable {
  name: string;
  type: 'string' | 'number' | 'boolean' | 'object';
  required: boolean;
  defaultValue?: any;
  description?: string;
}
```

**C. 변수 치환 로직**

- Handlebars 스타일 변수: `{{variableName}}`
- 중첩 객체 지원: `{{hollon.name}}`, `{{team.name}}`
- 조건부 렌더링 없음 (Phase 1 - 단순 치환만)

**D. 병합 전략**

```typescript
// Priority: DB > Code Template > Default
function mergePrompts(codeTemplate: string, dbPrompt: string | null): string {
  if (dbPrompt !== null && dbPrompt.trim() !== '') {
    return dbPrompt; // DB 우선
  }
  return codeTemplate; // 코드 템플릿 fallback
}
```

**E. 캐싱 전략 (Phase 2)**

- 메모리 캐시: 템플릿 조회 결과
- TTL: 5분 (템플릿은 자주 변경되지 않음)
- 캐시 무효화: 템플릿 업데이트 시

#### 3. Implementation Strategy

**Phase 1: Core Infrastructure (P1 Tasks 1-3, 9-10)**

1. 디렉토리 구조 및 인터페이스 정의
2. 시드 데이터 분석 및 추출
3. PromptTemplateRegistry 서비스 구현
4. PromptMergeService 구현

**Phase 2: Template Files (P2 Tasks 4-8)** 5. 각 Role별 템플릿 파일 생성 6. 변수 치환 로직 구현 7. 템플릿 검증 로직 추가

**Phase 3: Integration (P1 Tasks 11-16)** 8. DTO 정의 및 컨트롤러 구현 9. Role/Hollon 서비스 통합 10. 시드 데이터 수정

**Phase 4: Advanced Features (P3 Tasks 17-19, 23)** 11. 버전 관리 시스템 12. 미리보기 기능 13. 문서화

**Phase 5: Testing & Optimization (P2-P4 Tasks 20-22, 24-26)** 14. 단위 테스트 및 통합 테스트 15. 성능 최적화 16. 프로덕션 배포

### Risks and Mitigations

| Risk                            | Impact                        | Mitigation                                                                   |
| ------------------------------- | ----------------------------- | ---------------------------------------------------------------------------- |
| **기존 프롬프트와 내용 불일치** | High - 홀론 동작 변경 가능    | 시드 데이터에서 추출한 프롬프트를 그대로 템플릿으로 복사. E2E 테스트로 검증  |
| **병합 로직 버그**              | High - 잘못된 프롬프트 생성   | 단위 테스트 커버리지 90% 이상. 각 병합 시나리오별 테스트 케이스 작성         |
| **성능 저하**                   | Medium - 프롬프트 조회 느려짐 | 캐싱 전략 적용 (메모리 캐시). 조회 성능 벤치마크 테스트                      |
| **DB 마이그레이션 필요**        | Low - 스키마 변경 없음        | DB 스키마는 변경하지 않음. systemPrompt 필드는 그대로 유지                   |
| **변수 치환 오류**              | Medium - 프롬프트 렌더링 실패 | 변수 검증 로직 추가. 필수 변수 누락 시 명확한 에러 메시지                    |
| **롤백 복잡도**                 | Medium - 배포 후 문제 발생 시 | 시드 데이터는 보존. 긴급 시 PromptMergeService를 사용하지 않도록 플래그 추가 |

## Decomposition

### Subtasks

본 Team Epic은 26개의 Implementation Task로 구성됩니다. 각 태스크는 독립적으로 PR을 생성할 수 있는 단위로 분해되었습니다.

#### Group 1: Foundation & Infrastructure (P1)

**1. 프롬프트 템플릿 모듈 디렉토리 구조 설계 및 생성**

- **Assignee recommendation**: Backend Engineer (TypeScript, NestJS)
- **Description**: `apps/server/src/modules/prompt-templates/` 디렉토리를 생성하고 templates/, services/, dtos/, interfaces/, controllers/ 하위 구조를 설계합니다. 모듈의 전체 아키텍처를 정의하고 README.md 파일에 문서화합니다.
- **Acceptance Criteria**:
  - `apps/server/src/modules/prompt-templates/` 디렉토리가 생성됨
  - `templates/`, `services/`, `dtos/`, `interfaces/`, `controllers/` 하위 디렉토리 구조가 존재함
  - `README.md`에 모듈 구조와 사용 방법이 문서화됨
  - 각 디렉토리에 `.gitkeep` 또는 index.ts 파일이 존재함

**2. 프롬프트 템플릿 인터페이스 및 타입 정의**

- **Assignee recommendation**: Backend Engineer (TypeScript)
- **Description**: IPromptTemplate, IRoleTemplate, IPromptVariable 등의 인터페이스를 정의합니다. Role 타입(CTO, TechLead, AILead, InfraLead 등), 프롬프트 버전 관리, 변수 치환을 위한 타입 시스템을 구축합니다.
- **Acceptance Criteria**:
  - `interfaces/prompt-template.interface.ts` 파일이 존재하고 모든 필요한 인터페이스가 정의됨
  - Role 타입이 enum 또는 union type으로 정의됨
  - 버전 관리를 위한 version 필드가 인터페이스에 포함됨
  - 변수 치환을 위한 타입 시스템이 구현됨
  - TypeScript strict mode에서 에러 없이 컴파일됨

**3. 현재 시드 데이터에서 시스템 프롬프트 추출 및 분석**

- **Assignee recommendation**: Backend Engineer
- **Description**: 기존 seed.ts 파일에서 Role별, Hollon별 systemPrompt를 추출하고 패턴을 분석합니다. 각 프롬프트의 구조, 공통 패턴, 변수, 그리고 Role별 차이점을 문서화합니다.
- **Acceptance Criteria**:
  - 모든 systemPrompt가 추출되어 문서화됨 (최소 14개 Role)
  - Role별 프롬프트 패턴이 분석되고 기록됨
  - 공통 변수와 Role 특화 변수가 식별됨
  - 분석 결과가 `docs/prompt-analysis.md` 파일로 작성됨

**9. 프롬프트 템플릿 레지스트리 서비스 구현**

- **Assignee recommendation**: Senior Backend Engineer (NestJS)
- **Description**: PromptTemplateRegistry 서비스를 구현하여 모든 Role 템플릿을 등록하고 조회할 수 있는 중앙 관리 시스템을 만듭니다. Role별 템플릿 조회, 버전 관리, 캐싱 기능을 포함합니다.
- **Acceptance Criteria**:
  - `services/prompt-template-registry.service.ts` 파일이 존재함
  - `@Injectable()` 데코레이터가 적용됨
  - `getTemplateByRole(roleName: string)` 메서드가 구현됨
  - `getAllTemplates()` 메서드가 구현됨
  - 템플릿 캐싱이 구현됨 (메모리 캐시)
  - 버전 관리 로직이 포함됨

**10. 프롬프트 병합 서비스 구현**

- **Assignee recommendation**: Senior Backend Engineer (NestJS)
- **Description**: PromptMergeService를 구현하여 코드 템플릿과 DB에 저장된 커스텀 프롬프트를 병합하는 로직을 작성합니다. 우선순위 규칙(DB 우선 또는 코드 우선)과 변수 치환 기능을 포함합니다.
- **Acceptance Criteria**:
  - `services/prompt-merge.service.ts` 파일이 존재함
  - `mergePrompts(codeTemplate: string, dbPrompt: string | null)` 메서드가 구현됨
  - DB 값과 코드 템플릿 병합이 정상 작동함
  - 변수 치환 로직이 구현됨 ({{variableName}} 형식)
  - 우선순위 규칙이 적용됨 (DB > Code)

**13. 프롬프트 템플릿 모듈 통합 및 등록**

- **Assignee recommendation**: Backend Engineer (NestJS)
- **Description**: PromptTemplateModule을 생성하고 모든 서비스, 컨트롤러를 등록합니다. AppModule에 import하여 전체 애플리케이션에서 사용 가능하도록 설정합니다.
- **Acceptance Criteria**:
  - `prompt-template.module.ts` 파일이 존재함
  - `@Module` 데코레이터에 모든 providers와 controllers가 등록됨
  - `AppModule`에 `PromptTemplateModule`이 import됨
  - 애플리케이션이 정상 실행됨 (`pnpm dev`)
  - 린트 오류 없음

**14. Role 서비스에서 프롬프트 템플릿 서비스 통합**

- **Assignee recommendation**: Senior Backend Engineer (NestJS)
- **Description**: 기존 Role 관련 서비스(RoleService 등)를 수정하여 PromptMergeService를 사용하도록 변경합니다. 하드코딩된 프롬프트를 제거하고 새 시스템을 통해 프롬프트를 가져오도록 리팩토링합니다.
- **Acceptance Criteria**:
  - `RoleService`가 `PromptMergeService`를 주입받음
  - 시스템 프롬프트 조회 시 새 서비스를 사용함 (새 메서드 추가)
  - 하드코딩된 프롬프트가 제거되지는 않음 (호환성 유지)
  - 기존 기능이 정상 작동함 (기존 테스트 통과)

**15. Hollon 서비스에서 프롬프트 템플릿 서비스 통합**

- **Assignee recommendation**: Senior Backend Engineer (NestJS)
- **Description**: HollonService를 수정하여 Hollon의 systemPrompt를 가져올 때 PromptMergeService를 사용하도록 변경합니다. Hollon 생성 및 업데이트 로직을 리팩토링합니다.
- **Acceptance Criteria**:
  - `HollonService`가 `PromptMergeService`를 주입받음
  - Hollon 생성 시 새 서비스를 통해 프롬프트를 가져옴 (optional)
  - 기존 기능이 정상 작동함 (기존 테스트 통과)
  - Hollon 업데이트 시에도 새 시스템이 적용됨

**26. 프로덕션 배포 및 모니터링 설정**

- **Assignee recommendation**: DevOps Engineer
- **Description**: 새 프롬프트 시스템을 프로덕션에 배포하고 모니터링을 설정합니다. 배포 후 검증, 로그 모니터링, 알림 설정을 포함합니다.
- **Acceptance Criteria**:
  - 프로덕션 배포가 완료됨
  - 배포 후 검증이 수행됨 (smoke test)
  - 로그 모니터링이 설정됨
  - 에러 알림이 작동함
  - 롤백 계획이 문서화됨

#### Group 2: Template Implementation (P2)

**4. CTO Role 기본 프롬프트 템플릿 구현**

- **Assignee recommendation**: Backend Engineer
- **Description**: `templates/roles/cto.template.ts` 파일을 생성하고 CTO Role의 기본 시스템 프롬프트를 코드로 작성합니다. 템플릿 변수 치환 로직을 포함하고, 시드 데이터에서 추출한 CTO 프롬프트를 기반으로 구현합니다.
- **Acceptance Criteria**:
  - `templates/roles/cto.template.ts` 파일이 존재함
  - CTO 프롬프트가 IPromptTemplate 인터페이스를 구현함
  - 변수 치환이 정상 작동함
  - 기존 시드 데이터의 CTO 프롬프트와 내용이 일치함

**5. TechLead Role 기본 프롬프트 템플릿 구현**

- **Assignee recommendation**: Backend Engineer
- **Description**: `templates/roles/tech-lead.template.ts` 파일을 생성하고 TechLead Role의 기본 시스템 프롬프트를 코드로 작성합니다. CTO 템플릿과 동일한 패턴을 따르며, TechLead 특화 내용을 포함합니다.
- **Acceptance Criteria**: (CTO와 동일)

**6. AILead Role 기본 프롬프트 템플릿 구현**

- **Assignee recommendation**: ML Engineer or Backend Engineer
- **Description**: `templates/roles/ai-lead.template.ts` 파일을 생성하고 AILead Role의 기본 시스템 프롬프트를 코드로 작성합니다. AI/ML 특화 지침과 책임사항을 포함합니다.
- **Acceptance Criteria**: (CTO와 동일)

**7. InfraLead Role 기본 프롬프트 템플릿 구현**

- **Assignee recommendation**: Backend Engineer or DevOps
- **Description**: `templates/roles/infra-lead.template.ts` 파일을 생성하고 InfraLead Role의 기본 시스템 프롬프트를 코드로 작성합니다. 인프라 및 DevOps 특화 지침을 포함합니다.
- **Acceptance Criteria**: (CTO와 동일)

**8. 기타 Role 프롬프트 템플릿 구현**

- **Assignee recommendation**: Backend Engineer
- **Description**: BackendEngineer, FrontendEngineer, QAEngineer, MLEngineer, DataEngineer, JuniorBackendEngineer, PlanningSpecialist, ImplementationSpecialist, TestingSpecialist, IntegrationSpecialist 등 나머지 Role들의 프롬프트 템플릿을 구현합니다.
- **Acceptance Criteria**:
  - 모든 Role (10개)에 대한 템플릿 파일이 존재함
  - 각 템플릿이 IPromptTemplate 인터페이스를 구현함
  - 기존 시드 데이터의 프롬프트와 내용이 일치함
  - `templates/roles/index.ts`에 모든 템플릿이 export됨

**11. 프롬프트 템플릿 DTO 정의**

- **Assignee recommendation**: Backend Engineer
- **Description**: CreatePromptTemplateDto, UpdatePromptTemplateDto, PromptTemplateResponseDto 등의 DTO를 정의하고 class-validator로 유효성 검증 규칙을 추가합니다.
- **Acceptance Criteria**:
  - `dtos/` 디렉토리에 모든 필요한 DTO가 정의됨 (4개 이상)
  - class-validator 데코레이터가 적용됨
  - IsString, IsEnum, IsOptional 등의 검증 규칙이 구현됨
  - 각 DTO가 해당 인터페이스를 구현하거나 확장함

**12. 프롬프트 템플릿 컨트롤러 구현**

- **Assignee recommendation**: Backend Engineer (NestJS)
- **Description**: PromptTemplateController를 구현하여 템플릿 조회 API를 제공합니다. GET /prompt-templates/:role, GET /prompt-templates/preview 등의 엔드포인트를 구현합니다.
- **Acceptance Criteria**:
  - `controllers/prompt-template.controller.ts` 파일이 존재함
  - `@Controller('prompt-templates')` 데코레이터가 적용됨
  - GET 엔드포인트들이 구현됨 (최소 2개)
  - DTO 유효성 검증이 작동함
  - 응답이 PromptTemplateResponseDto 형식을 따름

**16. 시드 데이터에서 systemPrompt 필드 제거**

- **Assignee recommendation**: Backend Engineer
- **Description**: seed.ts 파일에서 systemPrompt 필드를 제거하거나 null로 설정합니다. 기본 프롬프트는 코드 템플릿에서 가져오고, 커스텀 프롬프트만 DB에 저장하도록 변경합니다.
- **Acceptance Criteria**:
  - `seed.ts`에서 systemPrompt 필드가 제거되거나 null로 설정됨
  - 시드 실행이 정상 작동함 (`pnpm seed`)
  - 생성된 Role/Hollon이 코드 템플릿에서 프롬프트를 가져옴
  - DB 마이그레이션 없이 변경사항이 적용됨

**20. 단위 테스트 - 프롬프트 템플릿 서비스**

- **Assignee recommendation**: QA Engineer or Backend Engineer
- **Description**: PromptTemplateRegistry, PromptMergeService의 단위 테스트를 작성합니다. 템플릿 조회, 병합, 변수 치환 등의 핵심 로직을 테스트합니다.
- **Acceptance Criteria**:
  - `*.spec.ts` 파일이 존재함 (2개 이상)
  - 테스트 커버리지가 80% 이상임
  - 모든 핵심 로직이 테스트됨 (조회, 병합, 변수 치환)
  - 테스트가 통과함 (`pnpm test`)

**21. 단위 테스트 - 프롬프트 템플릿 컨트롤러**

- **Assignee recommendation**: QA Engineer or Backend Engineer
- **Description**: PromptTemplateController의 단위 테스트를 작성합니다. API 엔드포인트, DTO 유효성 검증, 응답 포맷을 테스트합니다.
- **Acceptance Criteria**:
  - `prompt-template.controller.spec.ts` 파일이 존재함
  - 모든 엔드포인트가 테스트됨
  - DTO 검증 로직이 테스트됨
  - 테스트가 통과함

**22. 통합 테스트 - Role과 Hollon 프롬프트 통합**

- **Assignee recommendation**: QA Engineer or Senior Backend Engineer
- **Description**: Role과 Hollon 서비스가 새 프롬프트 시스템과 정상적으로 통합되었는지 E2E 테스트를 작성합니다. 전체 플로우를 테스트합니다.
- **Acceptance Criteria**:
  - E2E 테스트 파일이 존재함 (`test/prompt-templates.e2e-spec.ts`)
  - Role 생성 플로우가 테스트됨
  - Hollon 생성 플로우가 테스트됨
  - 프롬프트 병합이 정상 작동함
  - 테스트가 통과함 (`pnpm test:e2e`)

#### Group 3: Advanced Features (P3)

**17. 프롬프트 버전 관리 시스템 구현**

- **Assignee recommendation**: Senior Backend Engineer
- **Description**: 프롬프트 템플릿의 버전을 관리하는 시스템을 구축합니다. 버전 히스토리, 버전별 조회, 롤백 기능을 구현합니다.
- **Acceptance Criteria**:
  - `PromptVersionService`가 구현됨
  - 버전 히스토리가 기록됨
  - 특정 버전으로 롤백 가능함
  - 버전별 조회 API가 작동함

**18. 프롬프트 템플릿 미리보기 기능 구현**

- **Assignee recommendation**: Backend Engineer
- **Description**: 변수가 치환된 최종 프롬프트를 미리 볼 수 있는 기능을 구현합니다. API 엔드포인트와 서비스 로직을 작성합니다.
- **Acceptance Criteria**:
  - GET /prompt-templates/preview 엔드포인트가 구현됨
  - 변수 치환이 정확하게 작동함
  - Role과 변수를 파라미터로 받음
  - 최종 프롬프트가 응답으로 반환됨

**19. 프롬프트 템플릿 유효성 검증 로직 구현**

- **Assignee recommendation**: Backend Engineer
- **Description**: 프롬프트 템플릿의 구조, 변수, 포맷을 검증하는 로직을 구현합니다. 필수 변수 누락, 잘못된 변수 참조 등을 감지합니다.
- **Acceptance Criteria**:
  - `PromptValidationService`가 구현됨
  - 필수 변수 누락 감지가 작동함
  - 잘못된 변수 참조가 감지됨
  - 검증 에러 메시지가 명확함

**23. 프롬프트 템플릿 관리 문서 작성**

- **Assignee recommendation**: Backend Engineer or Technical Writer
- **Description**: 프롬프트 템플릿 시스템의 사용 방법, 아키텍처, API 문서를 작성합니다. 새 Role 추가 방법, 변수 사용법, 커스터마이징 가이드를 포함합니다.
- **Acceptance Criteria**:
  - `docs/prompt-template-system.md` 파일이 존재함
  - 아키텍처 다이어그램이 포함됨
  - API 엔드포인트가 문서화됨
  - 새 Role 추가 가이드가 작성됨
  - 변수 사용 예시가 포함됨

#### Group 4: Optimization & Production (P4)

**24. 성능 최적화 - 프롬프트 캐싱**

- **Assignee recommendation**: Senior Backend Engineer
- **Description**: 프롬프트 템플릿 조회 성능을 최적화하기 위해 캐싱 전략을 구현합니다. 메모리 캐시 또는 Redis 기반 캐싱을 적용합니다.
- **Acceptance Criteria**:
  - 캐싱 로직이 구현됨 (메모리 캐시 우선)
  - 캐시 무효화 전략이 정의됨 (TTL: 5분)
  - 조회 성능이 개선됨 (벤치마크 결과)
  - 캐시 히트율이 모니터링됨

**25. 프롬프트 템플릿 변경 로깅 및 감사**

- **Assignee recommendation**: Backend Engineer
- **Description**: 프롬프트 템플릿 변경 이력을 로깅하고 감사하는 시스템을 구현합니다. 누가, 언제, 무엇을 변경했는지 추적합니다.
- **Acceptance Criteria**:
  - 변경 이력이 DB에 저장됨
  - 사용자 정보가 기록됨
  - 변경 전후 내용이 저장됨
  - 감사 로그 조회 API가 구현됨

### Dependencies

**Task Dependencies (Critical Path)**

```
[1] 디렉토리 구조 생성
  ↓
[2] 인터페이스 정의
  ↓
[3] 시드 데이터 분석 ──┐
  ↓                    │
[9] Registry Service   │
  ↓                    │
[10] Merge Service ←───┘
  ↓
[4-8] Template Files (병렬 가능)
  ↓
[11] DTOs 정의
  ↓
[12] Controller 구현
  ↓
[13] Module 통합
  ↓
[14-15] Service 통합 (병렬 가능)
  ↓
[16] 시드 데이터 수정
  ↓
[20-22] Testing (병렬 가능)
  ↓
[17-19, 23-25] Advanced Features (병렬 가능)
  ↓
[26] 프로덕션 배포
```

**Parallel Execution Opportunities**

- Tasks 4-8 (템플릿 파일 작성)은 병렬 실행 가능
- Tasks 14-15 (서비스 통합)는 병렬 실행 가능
- Tasks 20-22 (테스트)는 병렬 실행 가능
- Tasks 17-19, 23-25 (고급 기능)는 병렬 실행 가능

## Success Criteria

### Functional Requirements

- [ ] 모든 14개 Role에 대한 템플릿 파일이 생성되고 정상 작동함
- [ ] 코드 템플릿과 DB 프롬프트 병합이 정확하게 작동함 (우선순위: DB > Code)
- [ ] 변수 치환 기능이 정상 작동함 ({{variableName}} 형식)
- [ ] Role 및 Hollon 서비스가 새 시스템과 통합됨
- [ ] 시드 데이터에서 systemPrompt가 제거되거나 null로 처리됨
- [ ] API 엔드포인트가 정상 작동함 (최소 2개)

### Quality Requirements

- [ ] 단위 테스트 커버리지 80% 이상
- [ ] E2E 테스트가 통과함
- [ ] 린트 오류 없음
- [ ] TypeScript strict mode에서 컴파일 성공
- [ ] 기존 기능이 정상 작동함 (회귀 테스트 통과)

### Performance Requirements

- [ ] 프롬프트 조회 성능이 기존 대비 유지 또는 개선됨
- [ ] 캐싱이 적용되어 반복 조회 시 성능 개선됨
- [ ] 애플리케이션 시작 시간이 1초 이상 증가하지 않음

### Documentation Requirements

- [ ] 모듈 README.md가 작성됨
- [ ] API 문서가 작성됨
- [ ] 새 Role 추가 가이드가 문서화됨
- [ ] 아키텍처 다이어그램이 포함됨

### Production Readiness

- [ ] 프로덕션 배포가 성공함
- [ ] 배포 후 smoke test 통과
- [ ] 모니터링 및 알림이 설정됨
- [ ] 롤백 계획이 문서화됨

---

_Generated by: PlanningSpecialist_
_Date: 2026-01-08T16:52:00.098Z_
_Status: PENDING_REVIEW_
